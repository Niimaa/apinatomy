!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("jquery"),require("d3"),require("bacon"),require("bluebird"));else if("function"==typeof define&&define.amd)define(["jquery","d3","bacon","bluebird"],e);else{var n="object"==typeof exports?e(require("jquery"),require("d3"),require("bacon"),require("bluebird")):e(t.jQuery,t.d3,t.Bacon,t.P);for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}(this,function(t,e,n,r){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){var r,o;r=[n(1),n(2),n(4),n(3),n(5),n(7)],o=function(t,e,n,r){"use strict";var o=t.circuitboard.plugin({name:"d3",requires:["core","position-tracking"]}).modify("Circuitboard.prototype");o.insert("construct",function(){var o=this;this._p_d3_vertices={},this._p_d3_edges={};var i=t('<svg class="d3">').appendTo(this.element).append('<svg x="1" y="1">').children();n.makePositioned(this.element),this.d3Force=e.layout.force().nodes(n.objValues(this._p_d3_vertices)).links(n.objValues(this._p_d3_edges)).gravity(0).charge(function(t){return-.025*t.group.chargeFactor*t.group.region.width*t.group.region.height*n.defOr(t.chargeFactor,1)/(t.group.vertices.length||1)}).linkDistance(function(t){return.01*t.group.linkDistanceFactor*t.group.region.width*t.group.region.height*n.defOr(t.linkDistanceFactor,1)/(t.group.vertices.length||1)}).linkStrength(.8),this.on("size").map(function(t){return[t.width,t.height]}).assign(this.d3Force,"size");var u,a,s=e.select(i[0]),c=s.selectAll(".edge"),f=s.selectAll(".vertex");this.updateGraph=n.debounce(function(){u=n.objValues(o._p_d3_vertices).filter(function(t){return t.visible}),a=n.objValues(o._p_d3_edges),o.d3Force.nodes(u).links(a).start(),f=s.selectAll(".vertex").data(u,function(t){return t.graphId}),f.enter().append(function(t){return t.element[0]}).classed("vertex",!0).classed("edge",!1).call(o.d3Force.drag),f.exit().remove(),c=s.selectAll(".edge").data(a,function(t){return t.graphId}),c.enter().append(function(t){return t.element[0]}).classed("edge",!0).classed("vertex",!1),c.exit().remove(),s.selectAll(".vertex, .edge").sort(function(t,e){return t.graphZIndex<e.graphZIndex?-1:t.graphZIndex===e.graphZIndex?0:1})},200);var d=function(){return e.select(e.event.sourceEvent.target.parentElement).data()[0]};this.newProperty("draggingVertex",{stream:r.mergeAll(r.fromOnNull(this.d3Force.drag(),"dragstart").map(d),r.fromOnNull(this.d3Force.drag(),"dragend").map(null))}),this.on("draggingVertex").log(),this.newEvent("d3-tick",{source:r.fromOn(this.d3Force,"tick")}).onValue(function(t){var e=.1*t.alpha;u.forEach(function(t){t.x+=t.group.gravityFactor*(t.group.region.left+.5*t.group.region.width-t.x)*e,t.y+=t.group.gravityFactor*(t.group.region.top+.5*t.group.region.height-t.y)*e}),u.forEach(function(t){t.x=Math.max(t.x,t.group.region.left),t.x=Math.min(t.x,t.group.region.left+t.group.region.width),t.y=Math.max(t.y,t.group.region.top),t.y=Math.min(t.y,t.group.region.top+t.group.region.height)}),f.attr("x",function(t){return t.x}).attr("y",function(t){return t.y}),c.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y})})})}.apply(e,r),!(void 0!==o&&(t.exports=o))},function(e){e.exports=t},function(t){t.exports=e},function(t){t.exports=n},function(t,e,n){var r,o;r=[n(6),n(3)],o=function(t,e){"use strict";var n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)},r={newClass:function(t,e){e=e||{};var n=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.apply(this,e)};return n.prototype=e,n.prototype.constructor=n,n},newSubclass:function(t,e){var n=void 0!==arguments[2]?arguments[2]:{},o=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];e.apply(this,[t.prototype.constructor.bind(this)].concat(n))};return o.prototype=Object.create(t.prototype),r.extend(o.prototype,n),o.prototype.constructor=o,o},extend:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return e.forEach(function(e){for(var n in e)e.hasOwnProperty(n)&&Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}),t},field:function(t){return function(e){return e[t]}},call:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t.apply(void 0,e)},object:function(t,e){return r.isUndefined(t[e])&&(t[e]={}),t[e]},array:function(t,e){return r.isUndefined(t[e])&&(t[e]=[]),t[e]},pull:function(t,e){var n=t.indexOf(e);-1!==n&&t.splice(n)},makeEmpty:function(t){for(;t.length>0;)t.pop()},bindA:function(t,e,n){return t.bind.apply(t,[e].concat(n))},bind:function(t,e){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return r.bindA(t[e],t,n)},applyConstructor:function(t,e){var n=t.bind.apply(t,[null].concat(e));return new n},assert:function(t,e){if(!t)throw new Error(e||"Assertion failed")},isUndefined:function(t){return"undefined"==typeof t},isDefined:function(t){return"undefined"!=typeof t},isPlainObject:function(t){return"object"==typeof t&&t.constructor===Object},isFunction:function(t){return"function"==typeof t},objValues:function(t){return Object.keys(t).map(function(e){return t[e]})},makePositioned:function(t){"static"===t.css("position")&&t.css("position","relative")},defOr:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;n+=1)if(r.isDefined(t[n]))return t[n]},debounce:function(t,e,n){var r;return function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];var u=this,a=function(){r=null,t.apply(n||u,o)};clearTimeout(r),r=setTimeout(a,e)}},animationFrames:function(){return e.fromBinder(function(t){var r=!1,o=function(){r||(t(),n(o))};return o(),function(){r=!0,t(new e.End)}})},oncePerStack:function(t,e){var n=!0,r=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];n&&(n=!1,setTimeout(function(){n=!0},0),t.apply(e||this,r))};return r.allowAdditionalCall=function(){n=!0},r},cached:function(t){function e(){var t=o(),e=u;i(t,e)||(u=t,c.forEach(function(n){return n(t,e)}))}var n=t,o=n.retrieve,i=n.isEqual;i=i||function(t,e){return t===e};var u,a=r.oncePerStack(e),s=function(){return a(),u},c=[];return s.onChange=function(t){return c.push(t),s},s.allowAdditionalCall=function(){a.allowAdditionalCall()},a(),s},promisify:function(e,n){return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return new t(function(t,o){try{e[n].apply(e,r.concat(t))}catch(i){o(i)}})}}};return r.Position=r.newClass(function(t,e){this.top=t,this.left=e}),r.Position.subtract=function(t,e){return new r.Position(t.top-e.top,t.left-e.left)},r.Position.equals=function(t,e){return r.isDefined(t)&&r.isDefined(e)&&t.top===e.top&&t.left===e.left},r.Size=r.newClass(function(t,e){this.height=t,this.width=e}),r.Size.equals=function(t,e){return r.isDefined(t)&&r.isDefined(e)&&t.height===e.height&&t.width===e.width},r}.apply(e,r),!(void 0!==o&&(t.exports=o))},function(t,e,n){var r,o;r=[n(1),n(4),n(3)],o=function(t,e,n){n.fromOn=function(t,e){return n.fromBinder(function(r){return t.on(e,function(t){r(new n.Next(t))})})},n.fromOnNull=function(t,e){return n.fromBinder(function(r){return t.on(e,function(t){r(new n.Next(t))}),function(){t.on(e,null)}})},n.fromOnOff=function(t,e){return n.fromBinder(function(r){var o=function(t){r(new n.Next(t))};return t.on(e,o),function(){t.off(e,o)}})}}.apply(e,r),!(void 0!==o&&(t.exports=o))},function(t){t.exports=r},function(t,e,n){var r=n(8);"string"==typeof r&&(r=[[t.id,r,""]]);n(9)(r)},function(t,e,n){e=t.exports=n(10)(),e.push([t.id,".circuitboard>svg.d3{display:block;position:absolute;left:0;top:0;height:100%;width:100%;padding:0;margin:0;pointer-events:none;}.circuitboard>svg.d3 svg.vertex{overflow:visible;cursor:pointer;}.circuitboard>svg.d3.dragging-vertex{pointer-events:all;cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing;}",""])},function(t){function e(t){for(var e=0;e<t.length;e++){var n=t[e],o=i[n.id];if(o){o.refs++;for(var u=0;u<o.parts.length;u++)o.parts[u](n.parts[u]);for(;u<n.parts.length;u++)o.parts.push(r(n.parts[u]))}else{for(var a=[],u=0;u<n.parts.length;u++)a.push(r(n.parts[u]));i[n.id]={id:n.id,refs:1,parts:a}}}}function n(t){for(var e=[],n={},r=0;r<t.length;r++){var o=t[r],i=o[0],u=o[1],a=o[2],s={css:u,media:a};n[i]?n[i].parts.push(s):e.push(n[i]={id:i,parts:[s]})}return e}function r(t){var e=document.createElement("style"),n=document.head||document.getElementsByTagName("head")[0];return e.type="text/css",n.appendChild(e),o(e,t),function(r){if(r){if(r.css===t.css&&r.media===t.media)return;o(e,t=r)}else n.removeChild(e)}}function o(t,e){var n=e.css,r=e.media;if(r&&t.setAttribute("media",r),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}var i={};t.exports=function(t){var r=n(t);return e(r),function(t){for(var o=[],u=0;u<r.length;u++){var a=r[u],s=i[a.id];s.refs--,o.push(s)}if(t){var c=n(t);e(c)}for(var u=0;u<o.length;u++){var s=o[u];if(0===s.refs){for(var f=0;f<s.parts.length;f++)s.parts[f]();delete i[s.id]}}}}},function(t){t.exports=function(){var t=[];return t.toString=function(){for(var t=[],e=0;e<this.length;e++){var n=this[e];t.push(n[2]?"@media "+n[2]+"{"+n[1]+"}":n[1])}return t.join("")},t}}])});
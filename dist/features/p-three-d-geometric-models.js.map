{"version":3,"sources":["webpack:///webpack/universalModuleDefinition?5ca6****************","webpack:///webpack/bootstrap 467eaae0cc717fc5d58e?85f0****************","webpack:///./src/Artefact.es6.js?3d36********","webpack:///external \"jquery\"?0b76****************","webpack:///external \"bluebird\"?fb3e***************","webpack:///./src/util/misc.es6.js?276f***************","webpack:///./src/util/defer.es6.js?ee8f***************","webpack:///./src/util/kefir-signal-handler.es6.js?0f01********","webpack:///./src/util/kefir-and-eggs.es6.js?515d**************","webpack:///external \"kefir\"?39df**************","webpack:///external \"tweenjs\"?d5a5***************","webpack:///external \"kefir-jquery\"?46a4**************","webpack:///./src/util/unique-id.es6.js?4c89********","webpack:///./src/util/main-deltajs.es6.js?d420********","webpack:///external \"delta-js\"?84b9********","webpack:///external \"three-js\"?e59f*****","webpack:///./src/ThreeDModel.es6.js?dd95","webpack:///./src/features/p-three-d-geometric-models.es6.js"],"names":[],"mappings":"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","file":"features/p-three-d-geometric-models.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"jquery\"), require(\"bluebird\"), require(\"kefir\"), require(\"tweenjs\"), require(\"kefir-jquery\"), require(\"delta-js\"), require(\"three-js\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"jquery\", \"bluebird\", \"kefir\", \"tweenjs\", \"kefir-jquery\", \"delta-js\", \"three-js\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"jquery\"), require(\"bluebird\"), require(\"kefir\"), require(\"tweenjs\"), require(\"kefir-jquery\"), require(\"delta-js\"), require(\"three-js\")) : factory(root[\"jquery\"], root[\"bluebird\"], root[\"kefir\"], root[\"tweenjs\"], root[\"kefir-jquery\"], root[\"delta-js\"], root[\"three-js\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(this, function(__WEBPACK_EXTERNAL_MODULE_2__, __WEBPACK_EXTERNAL_MODULE_3__, __WEBPACK_EXTERNAL_MODULE_8__, __WEBPACK_EXTERNAL_MODULE_9__, __WEBPACK_EXTERNAL_MODULE_10__, __WEBPACK_EXTERNAL_MODULE_13__, __WEBPACK_EXTERNAL_MODULE_15__) {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 467eaae0cc717fc5d58e\n **/","define([\n\t'jquery',\n\t'bluebird',\n\t'./util/misc.es6.js',\n\t'./util/kefir-signal-handler.es6.js',\n\t'./util/unique-id.es6.js',\n\t'./util/main-deltajs.es6.js',\n\t'./util/defer.es6.js'\n], function ($, P, U, KefirSignalHandler, uniqueID, deltaJs, defer) {\n\t'use strict';\n\n\n\treturn deltaJs.selected.then(() => {\n\n\n\t\t/* however (often) this is loaded, create the class only once */\n\t\tif (U.isDefined(window._amy_Artefact)) { return window._amy_Artefact }\n\n\n\t\t/** {@export @class Artefact @extends KefirSignalHandler}\n\t\t * Use this as a subclass (or just mix it in) to provide support for\n\t\t * events and observable properties through Kefir.js.\n\t\t *\n\t\t * Users can pass a promise through the 'beforeConstruction' option. If done, the\n\t\t * artefact waits on that promise before calling its 'construct' method.\n\t\t * Similarly, users of instances of this class should test the 'constructed' property.\n\t\t * If it is defined, it is a promise that has to be waited for.\n\t\t * If not, the object instance can be used synchronously after construction.\n\t\t */\n\t\twindow._amy_Artefact = deltaJs.vp('Artefact', U.newSubclass(KefirSignalHandler, (superFn) => function Artefact(options) {\n\t\t\tsuperFn.apply(this, arguments);\n\n\t\t\tthis._options = options;\n\t\t\tvar {id, type, parent, beforeConstruction} = options;\n\n\t\t\t/* set hierarchy stuff */\n\t\t\tthis._id = id || uniqueID(type);\n\t\t\tthis._type = type;\n\t\t\tthis._parent = parent;\n\t\t\tthis._children = [];\n\t\t\tif (parent) { U.array(parent, '_children').push(this) }\n\n\t\t\t/* create events */\n\t\t\tthis.newEvent('destroy');\n\n\t\t\t/* possibly wait for something before construction (like plugins)? */\n\t\t\tthis.beforeConstruction(beforeConstruction);\n\n\t\t\t/* give the root artefact a way to register other artefacts by ID */\n\t\t\tif (this.root === this) {\n\t\t\t\tthis._artefactsByID = {};\n\t\t\t\tthis._registerArtefact = function (artefact) {\n\t\t\t\t\tU.getDef(this._artefactsByID, artefact.id, defer).resolve(artefact);\n\t\t\t\t};\n\t\t\t}\n\n\t\t}, /** @lends Artefact.prototype */ {\n\n\t\t\t/* quick access to the model of an artifact */\n\t\t\tget model() { return this.options.model },\n\n\t\t\t/** {@public}{@method}\n\t\t\t * Allow a promise to be inserted on which the rest of construction should wait.\n\t\t\t *\n\t\t\t * @param possiblePromise {*}  - a value that might be a promise\n\t\t\t */\n\t\t\tbeforeConstruction(possiblePromise) {\n\n\t\t\t\t/* if no promise is passed in, ignore, to keep construction synchronous */\n\t\t\t\tif (!possiblePromise || !$.isFunction(possiblePromise.then)) { return }\n\n\t\t\t\t/* if this is the first promise passed in, initialize 'this.constructed' */\n\t\t\t\tif (!this.constructed) { this.constructed = P.resolve(this) }\n\n\t\t\t\t/* insert the new promise into the chain for 'this.constructed' resolution */\n\t\t\t\tthis.constructed = this.constructed.tap(() => P.resolve(possiblePromise));\n\n\t\t\t},\n\n\t\t\t/** {@public}{@property}\n\t\t\t *\n\t\t\t * @return {Object} - the options provided through the constructor\n\t\t\t */\n\t\t\tget options() { return this._options },\n\n\t\t\t/** {@public}{@property}\n\t\t\t *\n\t\t\t * @return {String} - the unique identifier belonging to this artefact\n\t\t\t */\n\t\t\tget id() { return this._id },\n\n\t\t\t/** {@public}{@property}\n\t\t\t *\n\t\t\t * @return {String} - the type of this artefact\n\t\t\t */\n\t\t\tget type() { return this._type },\n\n\t\t\t/** {@public}{@property}\n\t\t\t *\n\t\t\t * @return {Artefact|undefined} - the parent of this artefact, unless this is the root\n\t\t\t */\n\t\t\tget parent() { return this._parent },\n\n\t\t\t/** {@public}{@property}\n\t\t\t *\n\t\t\t * @return {[Artefact]} - the children of this artefact\n\t\t\t */\n\t\t\tget children() { return this._children },\n\n\t\t\t/** {@public}{@property}\n\t\t\t *\n\t\t\t * @return {Artefact} - the root of the artefact hierarchy\n\t\t\t */\n\t\t\tget root() {\n\t\t\t\tif (!this._root) { this._root = this.parent ? this.parent.root : this }\n\t\t\t\treturn this._root;\n\t\t\t},\n\n\t\t\t/** {@public}{@method}\n\t\t\t *\n\t\t\t * Get a promise to an artefact given its ID.\n\t\t\t *\n\t\t\t * @param  id {String}   - the id of the required artefact\n\t\t\t * @return {P<Artefact>} - the promise to the artefact that has the given id\n\t\t\t */\n\t\t\tartefactById(id) {\n\t\t\t\treturn U.getDef(this.root._artefactsByID, id, defer).promise;\n\t\t\t},\n\n\t\t\t/** {@public}{@method}\n\t\t\t *\n\t\t\t * Traverse the Artefact hierarchy with this as root.\n\t\t\t *\n\t\t\t * @param fn {(Artefact) => Boolean} - the function to call on each artefact\n\t\t\t */\n\t\t\ttraverseArtefacts(fn, options = {}) {\n\t\t\t\tvar {order} = options;\n\t\t\t\tif (!order) { order = 'prefix' }\n\n\t\t\t\tif (order === 'prefix') { fn(this) }\n\t\t\t\tthis.children.forEach((child) => {\n\t\t\t\t\tchild.traverseArtefacts(fn, options);\n\t\t\t\t});\n\t\t\t\tif (order === 'postfix') { fn(this) }\n\t\t\t},\n\n\t\t\t/** {@public}{@method}\n\t\t\t *\n\t\t\t * Traverse the Artefact hierarchy with this as root.\n\t\t\t *\n\t\t\t * @param fn {(Artefact) => Boolean} - the function to call on each artefact\n\t\t\t */\n\t\t\ttraverseArtefactsByType(type, fn, options = {}) {\n\t\t\t\tvar {order} = options;\n\t\t\t\tif (!order) { order = 'prefix' }\n\n\t\t\t\tif (order === 'prefix' && this.type === type) { fn(this) }\n\t\t\t\tif (options.beforeGoingIn) { options.beforeGoingIn(this) }\n\t\t\t\tthis.closestDescendantsByType(type).forEach((descendent) => {\n\t\t\t\t\tdescendent.traverseArtefactsByType(type, fn, options);\n\t\t\t\t});\n\t\t\t\tif (options.beforeGoingOut) { options.beforeGoingOut(this) }\n\t\t\t\tif (order === 'postfix' && this.type === type) { fn(this) }\n\t\t\t},\n\n\t\t\t/** {@public}{@method}\n\t\t\t *\n\t\t\t * Retrieve the closest ancestor (parent, parent's parent, ...)\n\t\t\t * of this artefact with the given type.\n\t\t\t *\n\t\t\t * @return {Artefact|undefined} - the closest ancestor of the given type, unless there is none\n\t\t\t */\n\t\t\tclosestAncestorByType(type) {\n\t\t\t\tvar result = this;\n\t\t\t\tdo { result = result.parent } while (result && result.type && result.type !== type);\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/** {@public}{@method}\n\t\t\t *\n\t\t\t * Retrieve the closest descendants (children, children's children, ...)\n\t\t\t * of this artefact with the given type.\n\t\t\t *\n\t\t\t * @return {[Artefact]} - the closest descendants of the given type; none of them\n\t\t\t *                        are descendant from any other\n\t\t\t */\n\t\t\tclosestDescendantsByType(type) {\n\t\t\t\tvar result = [];\n\t\t\t\tthis.children.forEach((child) => {\n\t\t\t\t\tif (child.type === type) {\n\t\t\t\t\t\tresult.push(child);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult = result.concat(child.closestDescendantsByType(type));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/** {@public}{@method}\n\t\t\t *\n\t\t\t * Retrieve the closest descendant (children, children's children, ...)\n\t\t\t * of this artefact with the given type.\n\t\t\t *\n\t\t\t * @return {Artefact} - the closest descendant of the given type\n\t\t\t */\n\t\t\tclosestDescendantByType(type) {\n\t\t\t\tfor (let child of this.children) {\n\t\t\t\t\tif (child.type === type) {\n\t\t\t\t\t\treturn child;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet result = child.closestDescendantByType(type);\n\t\t\t\t\t\tif (result) { return result }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t},\n\n\t\t\t/** {@public}{@method}\n\t\t\t *\n\t\t\t * Indicate that this artefact will never be used again, allowing it\n\t\t\t * to do any necessary cleanup.\n\t\t\t */\n\t\t\tdestroy() {\n\t\t\t\tthis.destroyed = true; // TODO: make this a property?\n\t\t\t\tthis.trigger('destroy');\n\t\t\t\tthis.children.forEach((child) => { child.destroy() });\n\t\t\t}\n\n\t\t}));\n\n\n\t\t/** {@function Artefact.newSubclass}\n\t\t * A static convenience function for creating a subclass of {@link Artefact}.\n\t\t */\n\t\twindow._amy_Artefact.newSubclass = function newSubclass(name, constructor, prototype = {}, optionDefaults = {}) {\n\t\t\treturn deltaJs.vp(name, U.newSubclass(window._amy_Artefact, (superFn) => function (options = {}) {\n\n\t\t\t\t/* process options */\n\t\t\t\tvar processedOptions = options;\n\t\t\t\tObject.keys(optionDefaults).forEach((key) => {\n\t\t\t\t\tif (U.isUndefined(processedOptions[key])) {\n\t\t\t\t\t\tprocessedOptions[key] = optionDefaults[key];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tprocessedOptions.type = name;\n\n\n\t\t\t\tlet _afterConstructDeferred = defer();\n\t\t\t\tthis.afterConstruct = _afterConstructDeferred.promise;\n\n\n\t\t\t\t/* call super-constructor */\n\t\t\t\tsuperFn.call(this, U.extend(options, processedOptions));\n\n\t\t\t\t/* call this constructor */\n\t\t\t\tconstructor.call(this, processedOptions);\n\n\t\t\t\t/* then run the 'construct' method */\n\t\t\t\tif (this.constructed) { // construct asynchronously\n\t\t\t\t\tthis.constructed = this.constructed.then(() => {\n\t\t\t\t\t\tif ($.isFunction(this.construct)) {\n\t\t\t\t\t\t\treturn P.resolve(this.construct(options)).return(this);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t});\n\t\t\t\t} else if ($.isFunction(this.construct)) {\n\t\t\t\t\tthis.beforeConstruction(this.construct(options));\n\t\t\t\t}\n\n\t\t\t\t/* register this artefact to the circuitboard */\n\t\t\t\t(this.constructed || P.resolve()).then(() => {\n\t\t\t\t\tthis.afterConstruct.then(() => {\n\t\t\t\t\t\tthis.root._registerArtefact(this);\n\t\t\t\t\t});\n\t\t\t\t\t_afterConstructDeferred.resolve();\n\t\t\t\t});\n\n\t\t\t}, U.extend({}, prototype, {\n\t\t\t\tget circuitboard() {\n\t\t\t\t\tif (!this._circuitboard) { this._circuitboard = this.closestAncestorByType('Circuitboard') }\n\t\t\t\t\treturn this._circuitboard;\n\t\t\t\t}\n\t\t\t})));\n\t\t};\n\n\n\t\treturn window._amy_Artefact;\n\n\n\t}).tap((c) => { $.circuitboard.Artefact = c });\n\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/Artefact.es6.js\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"jquery\"\n ** module id = 2\n ** module chunks = 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 50 52 53 56 57 58\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_3__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"bluebird\"\n ** module id = 3\n ** module chunks = 0 1 2 3 4 5 6 7 8 10 11 12 13 14 15 16 19 21 22 23 24 25 28 30 31 32 33 34 37 39 41 42 43 44 48 50 51 52 53 54 55 56 57 59\n **/","define(['bluebird', './defer.es6.js'], (P, defer) => {\n\t'use strict';\n\n\tvar U = {\n\n\t\t//// create a new class, given a constructor and possible prototype\n\t\t//newClass(constructor, prototype = {}) {\n\t\t//\tconstructor.prototype = prototype;\n\t\t//\tconstructor.prototype.constructor = constructor;\n\t\t//\treturn constructor;\n\t\t//}, // Already made redundant by ES6; TODO: do same for `newSubclass`\n\n\t\t// create a new subclass, given a superclass, constructor and possible prototype\n\t\tnewSubclass(superClass, constructorMaker, prototype = {}) {\n\t\t\tvar constructor = constructorMaker(superClass.prototype.constructor);\n\t\t\tconstructor.prototype = Object.create(superClass.prototype);\n\t\t\tU.extend(constructor.prototype, prototype);\n\t\t\tconstructor.prototype.constructor = constructor;\n\t\t\treturn constructor;\n\t\t},\n\n\t\t// extend the first passed object with the properties\n\t\t// of the other objects, from left to right, and returns\n\t\t// the first passed object\n\t\textend(obj1, ...rest) {\n\t\t\trest.forEach((obj) => {\n\t\t\t\tfor (var key in obj) {\n\t\t\t\t\tif (obj.hasOwnProperty(key)) {\n\t\t\t\t\t\tObject.defineProperty(obj1, key, Object.getOwnPropertyDescriptor(obj, key));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn obj1;\n\t\t},\n\n\t\t// create a function that returns the value of\n\t\t// a specific field from a given object\n\t\tfield(name) { return (obj) => { return obj[name] } },\n\n\t\t// create a function that returns the value of\n\t\t// a specific field from a given object\n\t\tcall(fn, ...args) { return fn.apply(undefined, args) },\n\n\t\t// a function that returns its first argument\n\t\tid(v) { return v },\n\n\t\t// get the object `obj[name]`; if `obj[name]` is not\n\t\t// defined, give it a default value first; if the given value\n\t\t// is a function, it is called, and its result is used\n\t\tgetDef(obj, name, value) {\n\t\t\tif (U.isUndefined(obj[name])) {\n\t\t\t\tif (typeof value === 'function') { value = value() }\n\t\t\t\tobj[name] = value;\n\t\t\t}\n\t\t\treturn obj[name];\n\t\t},\n\n\t\t// get the object `obj[name]`; if `obj[name]` is not\n\t\t// a (plain) object, make it an empty object first\n\t\tobject(obj, name) { return U.getDef(obj, name, {}) },\n\n\t\t// get the array `obj[name]`; if `obj[name]` is not\n\t\t// an array, make it an empty array first\n\t\tarray(obj, name) { return U.getDef(obj, name, []) },\n\n\t\t// pull a value from an array\n\t\tpull(arr, val) {\n\t\t\tvar i = arr.indexOf(val);\n\t\t\tif (i !== -1) { arr.splice(i) }\n\t\t},\n\n\t\t// empty out an array\n\t\tmakeEmpty(arr) {\n\t\t\twhile (arr.length > 0) { arr.pop() }\n\t\t},\n\n\t\t// `Function.bind`, but taking an array like `Function.apply` does\n\t\tbindA(fn, ctx, args) { return fn.bind.apply(fn, [ctx].concat(args)) },\n\n\t\t// `Function.bind`, but only having to specify the context-object once\n\t\tbind(obj, m, ...args) { return U.bindA(obj[m], obj, args) },\n\n\t\t// allows the Function constructor to be used\n\t\t// with an array of formal parameters\n\t\tapplyConstructor(ConstructorFn, args) {\n\t\t\tvar NewConstructorFn = ConstructorFn.bind.apply(ConstructorFn, [null].concat(args));\n\t\t\treturn new NewConstructorFn();\n\t\t},\n\n\t\t// a simple `assert` function, to express a\n\t\t// condition that is expected to be true\n\t\tassert(condition, message) {\n\t\t\tif (!condition) { throw new Error(message || \"Assertion failed\") }\n\t\t},\n\n\t\t// test if a value is `undefined`\n\t\tisUndefined(val) { return typeof val === 'undefined' },\n\n\t\t// test if a value is defined (not `undefined`)\n\t\tisDefined(val) { return typeof val !== 'undefined' },\n\n\t\t// test if a value is a plain object\n\t\tisPlainObject(val) { return typeof val === 'object' && val.constructor === Object },\n\n\t\t// test if a value is a function\n\t\tisFunction(val) { return typeof val === 'function' },\n\n\t\t// extract an array of values from an object\n\t\tobjValues(obj) { return Object.keys(obj).map(key => obj[key]) },\n\n\t\t// enable an HTML element to serve as anchor for absolutely positioned children\n\t\tmakePositioned(element) {\n\t\t\tif (element.css('position') === 'static') {\n\t\t\t\telement.css('position', 'relative');\n\t\t\t}\n\t\t},\n\n\t\t// return the first parameter that is not 'undefined'\n\t\tdefOr(...values) {\n\t\t\tfor (var i = 0; i < values.length; i += 1) {\n\t\t\t\tif (U.isDefined(values[i])) { return values[i] }\n\t\t\t}\n\t\t},\n\n\t\t// Returns a function, that, as long as it continues to be invoked, will not\n\t\t// be triggered. The function will actually be invoked after it stops being called\n\t\t// for N milliseconds. Every invocation returns a promise to the eventual result.\n\t\tdebounce(func, wait, context) {\n\t\t\tvar timeout;\n\t\t\tvar deferred = defer();\n\t\t\treturn function (...args) {\n\t\t\t\tvar laterFn = () => {\n\t\t\t\t\ttimeout = null;\n\t\t\t\t\tdeferred.resolve(func.apply(context || this, args));\n\t\t\t\t\tdeferred = defer();\n\t\t\t\t};\n\t\t\t\tclearTimeout(timeout);\n\t\t\t\ttimeout = setTimeout(laterFn, wait);\n\t\t\t\treturn deferred.promise;\n\t\t\t};\n\t\t},\n\n\t\t// Returns a function, that will only be triggered once per synchronous 'stack'.\n\t\toncePerStack(func, context) {\n\t\t\tvar notRunYet = true;\n\t\t\tvar result = function (...args) {\n\t\t\t\tif (notRunYet) {\n\t\t\t\t\tnotRunYet = false;\n\t\t\t\t\tsetTimeout(() => { notRunYet = true }, 0);\n\t\t\t\t\tfunc.apply(context || this, args);\n\t\t\t\t}\n\t\t\t};\n\t\t\tresult.allowAdditionalCall = () => {\n\t\t\t\tnotRunYet = true;\n\t\t\t};\n\t\t\treturn result;\n\t\t},\n\n\t\t/*  Create a new cache to manage a specific value that is costly to compute or retrieve.    */\n\t\t/*  It ensures that the retrieval function is not called only once per stack, and uses a    */\n\t\t/*  cache to return a known value in between. It is also able to notify you when the value  */\n\t\t/*  has actually changed. It does so using `===` comparison, but you can provide your own   */\n\t\t/*  comparison function.                                                                    */\n\t\tcached({retrieve, isEqual}) {\n\n\t\t\t/* normalize parameters */\n\t\t\tisEqual = isEqual || ((a, b) => (a === b));\n\n\t\t\t/* keep a cache and give it an initial value */\n\t\t\tvar cache;\n\n\t\t\t/* how to retrieve a new value, and process it if it is new */\n\t\t\tfunction retrieveValue() {\n\t\t\t\tvar newValue = retrieve();\n\t\t\t\tvar oldValue = cache;\n\t\t\t\tif (!isEqual(newValue, oldValue)) {\n\t\t\t\t\tcache = newValue;\n\t\t\t\t\tonChange.forEach((fn) => fn(newValue, oldValue));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* retrieve a value at most once per stack */\n\t\t\tvar oncePerStackSetValue = U.oncePerStack(retrieveValue);\n\n\t\t\t/*  the resulting function possibly performs retrieval,             */\n\t\t\t/*  and always returns the cache (which may contain the new value)  */\n\t\t\tvar resultFn = () => {\n\t\t\t\toncePerStackSetValue();\n\t\t\t\treturn cache;\n\t\t\t};\n\n\t\t\t/* allow an onChange callback to be set */\n\t\t\tvar onChange = [];\n\t\t\tresultFn.onChange = (cb) => {\n\t\t\t\tonChange.push(cb);\n\t\t\t\treturn resultFn;\n\t\t\t};\n\n\t\t\t/* allow breaking of the cache, allowing multiple calls per stack */\n\t\t\tresultFn.allowAdditionalCall = () => {\n\t\t\t\toncePerStackSetValue.allowAdditionalCall();\n\t\t\t};\n\n\t\t\t/* retrieve the first value right now */\n\t\t\toncePerStackSetValue();\n\n\t\t\treturn resultFn;\n\t\t},\n\n\t\tpromisify(obj, method) {\n\t\t\treturn function (...args) {\n\t\t\t\treturn new P((resolve, reject) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tobj[method].apply(obj, args.concat(resolve));\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t},\n\n\t\tfindIndex(array, pred) {\n\t\t\tfor (var i = 0; i < array.length; ++i) {\n\t\t\t\tif (pred(array[i], i, array)) { return i }\n\t\t\t}\n\t\t\treturn -1;\n\t\t},\n\n\t\t// this `memoize` function is SLOW, as it uses linear search\n\t\tmemoize(fn) {\n\t\t\tvar keys = [];\n\t\t\tvar cache = [];\n\t\t\treturn function (...args) {\n\t\t\t\t/* check the cache */\n\t\t\t\tvar index = U.findIndex(keys, (key) => key.every((v, i) => v === args[i]));\n\t\t\t\tif (index >= 0) { return cache[index] }\n\n\t\t\t\t/* no cache hit; compute value, store and return */\n\t\t\t\tvar result = fn.apply(this, args);\n\t\t\t\tkeys.push(args);\n\t\t\t\tcache.push(result);\n\t\t\t\treturn result;\n\t\t\t};\n\t\t},\n\n\t\tgetQueryVariable(variable) {\n\t\t\tlet query = window.location.search.substring(1);\n\t\t\tlet vars = query.split('&');\n\t\t\tfor (let i = 0; i < vars.length; ++i) {\n\t\t\t\tlet pair = vars[i].split('=');\n\t\t\t\tif(pair[0] === variable) { return pair[1] }\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t};\n\n\n\tvar EPS = 0.000001;\n\tvar sortOfEqual = (a, b) => (b - EPS < a && a < b + EPS);\n\n\t/* HTML element position */\n\tU.Position = class Position {\n\t\tconstructor(top, left) {\n\t\t\tthis.top = top;\n\t\t\tthis.left = left;\n\t\t}\n\t};\n\tU.Position.subtract = (a, b) => {\n\t\treturn new U.Position(a.top - b.top, a.left - b.left);\n\t};\n\tU.Position.equals = (a, b) => {\n\t\treturn U.isDefined(a) && U.isDefined(b) && sortOfEqual(a.top, b.top) && sortOfEqual(a.left, b.left);\n\t};\n\n\n\t/* HTML element size */\n\tU.Size = class Size {\n\t\tconstructor(height, width) {\n\t\t\tthis.height = height;\n\t\t\tthis.width = width;\n\t\t}\n\t};\n\tU.Size.equals = (a, b) => {\n\t\treturn U.isDefined(a) && U.isDefined(b) && sortOfEqual(a.height, b.height) && sortOfEqual(a.width, b.width);\n\t};\n\n\n\treturn U;\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/misc.es6.js\n **/","define(['bluebird'], function (P) {\n\t'use strict';\n\n\treturn function defer() {\n\t\tvar resolve, reject;\n\t\tvar promise = new P(function() {\n\t\t\tresolve = arguments[0];\n\t\t\treject = arguments[1];\n\t\t});\n\t\t//noinspection JSUnusedAssignment\n\t\treturn {\n\t\t\tresolve: resolve,\n\t\t\treject: reject,\n\t\t\tpromise: promise\n\t\t};\n\t};\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/defer.es6.js\n **/","'use strict';\n\ndefine(['jquery', './misc.es6.js', './kefir-and-eggs.es6.js'], function ($, U, Kefir) {\n\n\n\t/** {@export}{@class KefirSignalHandler}\n\t * Use this as a subclass (or just mix it in) to provide support for\n\t * events and observable properties through Kefir.js.\n\t */\n\tvar KefirSignalHandler = class KefirSignalHandler {\n\n\t\tconstructor() {\n\t\t\tthis._events = {};\n\t\t\tthis._properties = {};\n\t\t\tthis._propertyBusses = {};\n\t\t}\n\n\t\t/** {@public}{@method}\n\t\t * Declares a new event stream for this object.\n\t\t *\n\t\t * @param  {String}        name    - the name of the event, used to trigger or subscribe to it\n\t\t * @param  {Kefir.Stream} [source] - another event stream to automatically trigger this event\n\t\t *\n\t\t * @return {Kefir.Bus} - the created event stream\n\t\t */\n\t\tnewEvent(name, {source} = {}) {\n\n\t\t\t/* is the event name already taken? */\n\t\t\tU.assert(!this._events[name],\n\t\t\t\t\t`There is already an event '${name}' on this object.`);\n\t\t\tU.assert(!this._properties[name],\n\t\t\t\t\t`There is already a property '${name}' on this object.`);\n\n\t\t\t/* define the event stream */\n\t\t\tvar bus = Kefir.bus();\n\t\t\tif (source) { bus.plug(source) }\n\t\t\treturn this._events[name] = bus;\n\n\t\t}\n\n\n\t\t/** {@public}{@method}\n\t\t * Retrieve an event stream by name. If the name of a property is given, a stream\n\t\t * based on changes to that property is returned.\n\t\t *\n\t\t * @param  {String}  name - the name of the event stream to retrieve\n\t\t * @return {Kefir.Stream} - the event stream associated with the given name\n\t\t */\n\t\tevent(name) {\n\n\t\t\t/* does the event exist? */\n\t\t\tU.assert(this._events[name],\n\t\t\t\t\t`There is no event '${name}' on this object.`);\n\n\t\t\t/* return it */\n\t\t\treturn this._events[name];\n\n\t\t}\n\n\t\t/** @alias event */\n\t\te(name) { return this.event(name) }\n\n\n\t\t/** {@public}{@method}\n\t\t * This method defines a new property on this object.\n\t\t *\n\t\t * @param  {String}                   name           - the name of the event stream to retrieve\n\t\t * @param  {Boolean}                 [settable=true] - whether the value can be manually set\n\t\t * @param  {*}                       [initial]       - the initial value of this property\n\t\t * @param  {function(*,*):Boolean}   [isEqual]       - a predicate function by which to test for duplicate values\n\t\t * @param  {function(*):*}           [map]           - a function to map incoming values to other values\n\t\t * @param  {[Kefir.Property]}        [mapWith]       - other properties used in the given 'map' function\n\t\t *\n\t\t * @return {Kefir.Property} - the property associated with the given name\n\t\t */\n\t\tnewProperty(name, {settable, initial, isEqual, map, mapWith} = {}) {\n\n\t\t\t/* is the property name already taken? */\n\t\t\tU.assert(!this._events[name],\n\t\t\t\t\t`There is already an event '${name}' on this object.`);\n\t\t\tU.assert(!this._properties[name],\n\t\t\t\t\t`There is already a property '${name}' on this object.`);\n\n\t\t\t/* default values */\n\t\t\tif (U.isUndefined(settable)) { settable = true }\n\n\t\t\t/* define the bus which manages the property */\n\t\t\tlet bus = Kefir.bus();\n\n\t\t\t/* define the property itself */\n\t\t\tlet property;\n\t\t\tif (map && mapWith) {\n\t\t\t\tproperty = this._properties[name] = Kefir\n\t\t\t\t\t.combine([ bus.toProperty(initial).skipDuplicates(isEqual), ...mapWith ], map)\n\t\t\t\t\t.toProperty(initial) // TODO: use map here too\n\t\t\t\t\t.skipDuplicates(isEqual);\n\t\t\t} else if (map && !mapWith) {\n\t\t\t\tproperty = this._properties[name] =\n\t\t\t\t\tbus\n\t\t\t\t\t.toProperty(map(initial))\n\t\t\t\t\t.map(map)\n\t\t\t\t\t.skipDuplicates(isEqual);\n\t\t\t} else {\n\t\t\t\tproperty = this._properties[name] =\n\t\t\t\t\tbus\n\t\t\t\t\t.toProperty(initial)\n\t\t\t\t\t.skipDuplicates(isEqual);\n\t\t\t}\n\n\t\t\t/* give the property additional methods */\n\t\t\tproperty.plug   = (observable) => { bus.plug(observable);   return property };\n\t\t\tproperty.unplug = (observable) => { bus.unplug(observable); return property };\n\t\t\tproperty.get = (() => {\n\t\t\t\tlet currentValue = initial;\n\t\t\t\tproperty.onValue((value) => { currentValue = value });\n\t\t\t\treturn () => currentValue;\n\t\t\t})();\n\t\t\tif (settable) {\n\t\t\t\tproperty.set = (value) => { bus.emit(value); return property };\n\t\t\t}\n\n\t\t\t/* add the property to the object interface */\n\t\t\tObject.defineProperty(this, name, {\n\t\t\t\tget: property.get,\n\t\t\t\tset: settable ? property.set : undefined\n\t\t\t});\n\n\t\t\t/* make the property active; it doesn't work if this isn't done (the nature of Kefir.js) */\n\t\t\tproperty.run();\n\t\t\tif (this._events['destroy']) {\n\t\t\t\tthis.event('destroy').onValue(() => { bus.end() });\n\t\t\t}\n\n\t\t\t/* return the property */\n\t\t\treturn property;\n\n\t\t}\n\n\n\t\t/** {@public}{@method}\n\t\t * Retrieve a property by name.\n\t\t *\n\t\t * @param  {String} name - the name of the property to retrieve\n\t\t * @return {Kefir.Property} - the property associated with the given name\n\t\t */\n\t\tproperty(name) { return this._properties[name] }\n\n\t\t/** @alias property */\n\t\tp(name) { return this.property(name) }\n\n\n\t\t/** {@public}{@method}\n\t\t * Trigger an event for all subscribers.\n\t\t *\n\t\t * @param {String} name  - the name of the event stream to trigger\n\t\t * @param {*}      value - the value to attach to the event\n\t\t */\n\t\ttrigger(name, value) {\n\n\t\t\t/* does the event stream exist? */\n\t\t\tU.assert(this._events[name],\n\t\t\t\t\t`There is no event '${name}' on this object.`);\n\n\t\t\t/* push the value to the stream */\n\t\t\tthis._events[name].emit(value);\n\n\t\t}\n\n\n\t\t/** {@public}{@method}\n\t\t * This method selects an existing stream or property, and then\n\t\t * either returns it, or creates a subscription to it, depending\n\t\t * on whether a callback is provided.\n\t\t *\n\t\t * @param {String}            name                 - the name of the event or property to subscribe to\n\t\t * @param {*}                [expectedValue]       - if provided, filters the stream by === equality with this value;\n\t\t *                                                   this may not be a plain object\n\t\t * @param {Object}           [options]             - a plain object for providing additional options\n\t\t * @param {Boolean}          [options.once=false]  - whether the stream ends after one event\n\t\t * @param {function(*):void} [callback]            - if provided, subscribes to this stream with the this callback\n\t\t *\n\t\t * @return {Kefir.Observable|function():undefined} - if no `callback` is provided, the specified event stream\n\t\t *                                                   or property; otherwise, a function to unsubscribe to said\n\t\t *                                                   stream or property\n\t\t */\n\t\ton(name, expectedValue, options, callback) {\n\t\t\tvar argsObj = this._gatherOnArguments(name, expectedValue, options, callback);\n\t\t\treturn this._on(argsObj);\n\t\t}\n\n\n\t\t/** {@private}{@method}\n\t\t * This method does the main work for {@link on}, but accepts\n\t\t * the parameters as one object, so it doesn't have to deal with parameter ordering.\n\t\t *\n\t\t * @return {Kefir.Observable|function():void}\n\t\t */\n\t\t_on({name, expectedValue, callback}) {\n\t\t\t/* does an event or property by this name exist? */\n\t\t\tU.assert(this._events[name] || this._properties[name],\n\t\t\t\t\t`There is no event or property '${name}' on this object.`);\n\n\t\t\t/* process name */\n\t\t\tvar result = this._events[name] || this._properties[name];\n\n\t\t\t/* process expectedValue */\n\t\t\tif (U.isDefined(expectedValue)) { result = result.filter((v) => v === expectedValue) }\n\n\t\t\t/* process callback */\n\t\t\tif (callback) { result = result.onValue(callback) }\n\n\t\t\treturn result;\n\t\t}\n\n\n\t\t/** {@private}{@method}\n\t\t * Process the arguments accepted by {@link on}.\n\t\t *\n\t\t * @return {Object}\n\t\t */\n\t\t_gatherOnArguments(...args) {\n\t\t\tvar result = { name: args.shift() };\n\n\t\t\t/* test for expected value argument */\n\t\t\tif (U.isDefined(args[0]) && !U.isFunction(args[0]) && !U.isPlainObject(args[0])) {\n\t\t\t\tresult.expectedValue = args.shift();\n\t\t\t}\n\n\t\t\t/* test for callback function */\n\t\t\tif (U.isDefined(args[0]) && U.isFunction(args[0])) {\n\t\t\t\tresult.callback = args.shift();\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t};\n\n\n\treturn KefirSignalHandler;\n\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/kefir-signal-handler.es6.js\n **/","'use strict';\n\ndefine(['jquery', './misc.es6.js', 'kefir', 'tweenjs', 'kefir-jquery'], function ($, U, Kefir, TWEEN, KefirJQuery) {\n\n\t/* Kefir jQuery plugin ********************************************************************************************/\n\n\tKefirJQuery.init(Kefir, $);\n\n\n\t/* EventStream generators *****************************************************************************************/\n\n\t// This method works with events that can have only one subscriber,\n\t// that can be un-subscribed by setting the subscriber to `null`.\n\t// This function is memoized, so only one subscription is taken,\n\t// and the same stream for it returned for each request.\n\tKefir.fromOnNull = U.memoize(function fromOnNull(obj, eventName) {\n\t\treturn Kefir.fromBinder((emitter) => {\n\t\t\tobj.on(eventName, emitter.emit);\n\t\t\treturn () => { obj.on(eventName, null) };\n\t\t});\n\t});\n\n\n\tvar requestAnimationFrameFn =\n\t\t\twindow.requestAnimationFrame       ||\n\t\t\twindow.webkitRequestAnimationFrame ||\n\t\t\twindow.mozRequestAnimationFrame    ||\n\t\t\twindow.oRequestAnimationFrame      ||\n\t\t\twindow.msRequestAnimationFrame     ||\n\t\t\t((f) => { window.setTimeout(f, 1000 / 60) });\n\tKefir.animationFrames = function animationFrames() {\n\t\treturn Kefir.fromBinder((emitter) => {\n\n\t\t\t/* self-calling animation-frame loop */\n\t\t\tvar subscribed = true;\n\t\t\t(function iterationFn() {\n\t\t\t\trequestAnimationFrameFn(() => {\n\t\t\t\t\temitter.emit();\n\t\t\t\t\tif (subscribed) { iterationFn() }\n\t\t\t\t});\n\t\t\t})();\n\n\t\t\t/* unsubscribe function */\n\t\t\treturn () => { subscribed = false };\n\n\t\t});\n\t};\n\n\n\tKefir.tween = function tween(objStart, objEnd, {duration, delay, easing}) {\n\n\t\t/* the tween */\n\t\tvar tw = new TWEEN.Tween(objStart).to(objEnd, duration);\n\n\t\t/* the returned bus */\n\t\tvar bus = Kefir.bus();\n\n\t\t/* a local function to plug in other streams, keeping track in order to 'end' the bus */\n\t\tvar addStream = (() => {\n\t\t\tvar chainedStreams = 0;\n\t\t\treturn (stream) => {\n\t\t\t\tchainedStreams += 1;\n\t\t\t\tbus.plug(stream);\n\t\t\t\tstream.onEnd(() => {\n\t\t\t\t\tchainedStreams -= 1;\n\t\t\t\t\tif (chainedStreams === 0) { bus.end() }\n\t\t\t\t});\n\t\t\t};\n\t\t})();\n\n\t\t/* main stream */\n\t\taddStream(Kefir.fromBinder((emitter) => {\n\t\t\tif (easing) { tw.easing(easing) }\n\t\t\tif (delay)  { tw.delay(delay) }\n\t\t\ttw.onUpdate(function () { emitter.emit(this) });\n\t\t\ttw.onComplete(emitter.end);\n\t\t}));\n\n\t\t/* adding tween-specific properties to the returned bus */\n\t\tbus.tween = tw;\n\t\tbus.start = () => {\n\t\t\ttw.start();\n\t\t\treturn bus;\n\t\t};\n\t\tbus.chain = (other) => {\n\t\t\taddStream(other);\n\t\t\ttw.chain(other.tween);\n\t\t\treturn bus;\n\t\t};\n\n\t\t/* returning the bus */\n\t\treturn bus;\n\n\t};\n\n\n\tKefir.keyPress = function keyPress(keyCode) {\n\t\treturn $(window).asKefirStream('keypress').filter((e) => e.keyCode === keyCode);\n\t};\n\n\n\tKefir.once = function once(value) {\n\t\treturn Kefir.fromBinder((emitter) => {\n\t\t\temitter.emit(value);\n\t\t\temitter.end();\n\t\t});\n\t\t//return Kefir.constant(value); // TODO: replace all 'once' calls with 'constant' calls; then remove 'once'\n\t};\n\n\n\tKefir.fromArray = function fromArray(array) {\n\t\treturn Kefir.fromBinder((emitter) => {\n\t\t\tarray.forEach(emitter.emit);\n\t\t\temitter.end();\n\t\t});\n\t};\n\n\n\t/* EventStream converters *****************************************************************************************/\n\n\n\t// This creates a 'window of opportunity' to limit other streams by.\n\t// This window is provided by the `pacing` observable. An optional `handler`\n\t// parameter can be given to do some setup and some breakdown. It is passed a function as an argument\n\t// that should be called *once* in the place where other streams can do their\n\t// thing. It returns a function used to wrap other streams. It does not\n\t// return a stream.\n\tKefir.limiter = function limiter(pacing, handler = U.call) {\n\t\tvar wantedBus = Kefir.bus();\n\t\tvar open =      Kefir.bus();\n\t\tvar close =     Kefir.bus();\n\n\t\t/* takes 'this' stream as pacing for a window of opportunity for other streams */\n\t\tpacing.filterBy(wantedBus.toProperty(false)).onValue(() => {\n\t\t\thandler(() => {\n\t\t\t\topen.emit();\n\t\t\t\twantedBus.emit(false);\n\t\t\t\tclose.emit();\n\t\t\t});\n\t\t});\n\n\t\t/* returns a function to wrap a stream in this wrapper */\n\t\treturn function (stream, {buffer} = {}) {\n\t\t\twantedBus.plug(stream.mapTo(true));\n\t\t\treturn Kefir.constant(true).take(1).concat(close).flatMapLatest(() => {\n\t\t\t\tvar accumulator = (arr, val) => (buffer ? arr.concat([val]) : [val]);\n\t\t\t\treturn stream.takeUntilBy(open).reduce(accumulator, []).flatMap(Kefir.fromArray);\n\t\t\t});\n\t\t};\n\t};\n\n\t// This restricts a given stream to a wrapper stream created with the method above.\n\t// All its original events are now fired inside the provided window. Set `options.buffer`\n\t// to `true` if all its events should be buffered and released inside the next window.\n\t// Otherwise, only the last event is retained.\n\tKefir.Observable.prototype.limitedBy = function limitedBy(wrapper, options) {\n\t\treturn wrapper(this, options);\n\t};\n\n\n\t// convert to a stream of 1-or-2 element arrays;\n\t// the first is just the element at that point in the stream\n\t// the second is the previous element in the stream, if there is one\n\tKefir.Observable.prototype.newOld = function newOld() {\n\t\treturn Kefir.fromArray([null, null]).concat(this).slidingWindow(2).map(([a, b]) => [b, a]);\n\t};\n\n\n\n\t// This is a cheap version of the limiter defined above. TODO: use the limiter where this is now used\n\tKefir.Stream.prototype.holdUntil = function holdUntil(pacing) {\n\t\treturn Kefir.fromBinder((emitter) => {\n\t\t\tvar buffer = [];\n\t\t\tvar unsubscribeToThis = this.onValue((value) => {\n\t\t\t\tbuffer.push(value);\n\t\t\t});\n\t\t\tvar unsubscribeToPacing = pacing.onValue(() => {\n\t\t\t\tif (buffer.length > 0) {\n\t\t\t\t\tvar oldBuffer = buffer;\n\t\t\t\t\tbuffer = [];\n\t\t\t\t\toldBuffer.forEach(emitter.emit);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn () => {\n\t\t\t\tunsubscribeToThis();\n\t\t\t\tunsubscribeToPacing();\n\t\t\t\tbuffer = null;\n\t\t\t};\n\t\t});\n\t};\n\n\t// This filters an observable to only let through values equal to the given value.\n\tKefir.Observable.prototype.value = function (value, comparator) {\n\t\tcomparator = comparator || (e => e === value);\n\t\treturn this.skipDuplicates().filter(comparator);\n\t};\n\n\t// This makes a subscription to an observable that doesn't do anything\n\tKefir.Observable.prototype.run = function () {\n\t\tvar doNothing = ()=>{};\n\t\tthis.onValue(doNothing);\n\t\treturn () => { this.offValue(doNothing) };\n\t};\n\n\t// This is a 'smart' .stopPropagation, marking events with a label\n\t// and skipping those that already have that label.\n\tKefir.Stream.prototype.skipPropagation = function (label) {\n\t\treturn this.filter((event) => {\n\t\t\treturn !U.array(event.originalEvent, '_onlyOnceFor')[label];\n\t\t}).map((event) => {\n\t\t\tU.array(event.originalEvent, '_onlyOnceFor')[label] = true;\n\t\t});\n\t};\n\n\t// Filter events to only certain keys / buttons. Can be a predicate function or single number.\n\tKefir.Stream.prototype.which = function (buttonId) {\n\t\tvar pred = (typeof buttonId === 'function') ? (buttonId) : (b => b === buttonId);\n\t\treturn this.filter((e) => pred(e.which));\n\t};\n\n\n\t/* EventStream generators *****************************************************************************************/\n\n\t$.fn.mouseDrag = function mouseDrag({threshold} = {}) {\n\t\treturn $(this).asKefirStream('mousedown').flatMap((mouseDownEvent) => {\n\t\t\tvar stream = $(document).asKefirStream('mousemove');\n\t\t\tif (threshold) {\n\t\t\t\tvar crossed = false;\n\t\t\t\tstream = stream.filter((mouseMoveEvent) => { // TODO: don't use 'filter', but something like 'skipUntil' or 'flatMap'\n\t\t\t\t\tif (crossed) { return true }\n\t\t\t\t\tvar dx = mouseDownEvent.pageX - mouseMoveEvent.pageX;\n\t\t\t\t\tvar dy = mouseDownEvent.pageY - mouseMoveEvent.pageY;\n\t\t\t\t\tif (dx * dx + dy * dy > threshold * threshold) { return crossed = true }\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn stream\n\t\t\t\t\t.takeUntilBy($(document).asKefirStream('mouseup'))\n\t\t\t\t\t.map((mouseMoveEvent) => ({ mouseDownEvent, mouseMoveEvent }));\n\t\t});\n\t};\n\n\t$.fn.mouseClick = function mouseClick({threshold} = {}) {\n\t\treturn $(this).asKefirStream('mousedown').flatMap((mouseDownEvent) => {\n\t\t\tvar untilStream = $(document).asKefirStream('mousemove');\n\t\t\tif (threshold) {\n\t\t\t\tvar crossed = false;\n\t\t\t\tuntilStream = untilStream.filter((mouseMoveEvent) => {\n\t\t\t\t\tif (crossed) { return true }\n\t\t\t\t\tvar dx = mouseDownEvent.pageX - mouseMoveEvent.pageX;\n\t\t\t\t\tvar dy = mouseDownEvent.pageY - mouseMoveEvent.pageY;\n\t\t\t\t\tif (dx * dx + dy * dy > threshold * threshold) { return crossed = true }\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn $(document).asKefirStream('mouseup').take(1).takeUntilBy(untilStream);\n\t\t});\n\t};\n\n\t$.fn.mouseWheel = function mouseWheel() {\n\t\treturn $(this).asKefirStream('mousewheel DOMMouseScroll');\n\t};\n\n\n\treturn Kefir;\n\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/kefir-and-eggs.es6.js\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_8__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"kefir\"\n ** module id = 8\n ** module chunks = 0 1 2 3 4 5 6 7 8 10 11 12 13 15 16 21 23 24 28 31 32 33 37 41 42 43 48 52 53 56 57\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_9__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"tweenjs\"\n ** module id = 9\n ** module chunks = 0 1 2 3 4 5 6 7 8 10 11 12 13 14 15 16 21 23 24 28 31 32 33 37 41 42 43 48 52 53 56 57\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_10__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"kefir-jquery\"\n ** module id = 10\n ** module chunks = 0 1 2 3 4 5 6 7 8 10 11 12 13 15 16 21 23 24 28 31 32 33 37 41 42 43 48 52 53 56 57\n **/","define([], function () {\n\t'use strict';\n\n\tvar _nextId = 0;\n\n\treturn function uniqueId(prefix) {\n\t\treturn `${prefix||\"unique-id\"}-${_nextId++}`;\n\t};\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/unique-id.es6.js\n **/","define(['bluebird', 'delta-js', './defer.es6.js'], function (P, DeltaJs, defer) {\n\t'use strict';\n\n\n\t/* already cached? */\n\tif (window.__apinatomy_core_deltajs) { return window.__apinatomy_core_deltajs }\n\n\n\t/* set the cache */\n\tvar deltaJs = window.__apinatomy_core_deltajs = new DeltaJs();\n\tvar deferred = defer();\n\tdeltaJs.selected = deferred.promise;\n\tvar oldSelect = deltaJs.select;\n\tdeltaJs.select = function (...args) {\n\t\toldSelect.apply(this, args);\n\t\tdeferred.resolve(args);\n\t};\n\n\n\t/* return the delta model that manages all plugins (= deltas) */\n\treturn window.__apinatomy_core_deltajs;\n\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/main-deltajs.es6.js\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_13__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"delta-js\"\n ** module id = 13\n ** module chunks = 0 1 2 3 4 5 6 11 12 16 54 57\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_15__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"three-js\"\n ** module id = 15\n ** module chunks = 1 5 11 13 14 16 17 18 19 20 21 23 24\n **/","define([\n\t'jquery',\n\t'three-js',\n\t'./util/misc.es6.js',\n\t'bluebird',\n\t'./util/kefir-and-eggs.es6.js',\n\t'./Artefact.es6.js'\n], function ($, THREE, U, P, Kefir, ArtefactP) {\n\t'use strict';\n\n\n\t/* convenience predicate functions */\n\tfunction isGeometry(v) { return v instanceof THREE.Geometry || v instanceof THREE.BufferGeometry }\n\tfunction isObject3D(v) { return v instanceof THREE.Object3D }\n\tfunction endsWith(str, suffix) { return str.indexOf(suffix, str.length - suffix.length) !== -1 }\n\n\n\t///* convenience function to visit all geometries in an Object3D */ // TODO: remove or use?\n\t//function traverseGeometries(obj, fn) {\n\t//\tobj.traverse((subObj) => {\n\t//\t\tif (U.isUndefined(subObj.geometry)) { return }\n\t//\t\tfn(subObj.geometry);\n\t//\t});\n\t//}\n\t//function traverseMeshes(obj, fn) {\n\t//\tobj.traverse((subObj) => {\n\t//\t\tif (U.isDefined(subObj.geometry)) { fn(subObj) }\n\t//\t});\n\t//}\n\n\n\t/* a promise to the new ThreeDModel class */\n\treturn ArtefactP.then((Artefact) => {\n\n\n\t\t/* however (often) this is loaded, create the class only once */\n\t\tif (U.isDefined(window._amy_ThreeDModel)) { return window._amy_ThreeDModel }\n\n\n\t\t/* create the class */\n\t\tvar ThreeDModel = window._amy_ThreeDModel = Artefact.newSubclass('ThreeDModel', function ThreeDModel({rootThreeDModel, visible, file, parts}) {\n\n\n\t\t\t/* what is the 'root' 3D model? */\n\t\t\tif (U.isUndefined(rootThreeDModel)) { rootThreeDModel = this }\n\t\t\tthis.rootThreeDModel = rootThreeDModel;\n\n\n\t\t\t/* the 'visible' and 'hidden' properties */\n\t\t\tthis.newProperty('visible', { initial: visible });\n\t\t\tthis.newProperty('hidden').plug(this.p('visible').not());\n\t\t\tthis.p('visible').plug(this.p('hidden').not());\n\n\n\t\t\t/* create any ThreeDModels parts (without (yet) loading their object3D) */\n\t\t\tObject.keys(parts|| {}).map((id) => {\n\n\t\t\t\t/* define the options we want to pass to the corresponding child artefact */\n\t\t\t\tvar newChildOptions = U.extend({}, parts[id], {\n\t\t\t\t\tid:              id,\n\t\t\t\t\tparent:          this,\n\t\t\t\t\tvisible:         visible,\n\t\t\t\t\trootThreeDModel: this.rootThreeDModel\n\t\t\t\t});\n\t\t\t\t['color', 'animation', 'clock'].forEach((prop) => {\n\t\t\t\t\tif (U.isUndefined(newChildOptions[prop])) {\n\t\t\t\t\t\tnewChildOptions[prop] = this.options[prop];\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t/* construct the child ThreeDModel */// jshint -W031\n\t\t\t\tnew window._amy_ThreeDModel(newChildOptions);\n\n\t\t\t});\n\n\n\t\t\t/* manifest the visibility of this model on the object3D */\n\t\t\tthis.object3D.then((object3D) => {\n\t\t\t\tthis.p('visible').merge(this.on('destroy').mapTo(false))\n\t\t\t\t\t.onValue((visible) => { object3D.visible = visible });\n\t\t\t});\n\n\n\t\t}, {\n\n\t\t\tget geometry3D() {\n\t\t\t\tif (!this._geometry3D) {\n\t\t\t\t\tthis._geometry3D = new P((resolve, reject) => {\n\t\t\t\t\t\tif (U.isDefined(this.options.file)) {\n\t\t\t\t\t\t\tthis.rootThreeDModel.p('visible').value(true).take(1).onValue(() => {\n\n\t\t\t\t\t\t\t\t/* resolve this promise by loading the proper file, when the root model first becomes visible */\n\t\t\t\t\t\t\t\tthis._loadGeometryFromFile().then(resolve, reject);\n\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t/* this ThreeDModel has no geometry */\n\t\t\t\t\t\t\tresolve(null);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn this._geometry3D;\n\t\t\t},\n\n\n\t\t\tget originalBoundingBox() {\n\t\t\t\tif (!this._originalBoundingBox) {\n\t\t\t\t\tthis._originalBoundingBox = new P((resolve, reject) => {\n\t\t\t\t\t\tif (U.isDefined(this.options.file)) {\n\t\t\t\t\t\t\tthis.geometry3D.then((geometry) => {\n\t\t\t\t\t\t\t\tvar boxFromFile = new THREE.Box3();\n\t\t\t\t\t\t\t\tif (geometry instanceof THREE.BufferGeometry) {\n\t\t\t\t\t\t\t\t\tgeometry.computeBoundingBox();\n\t\t\t\t\t\t\t\t\tboxFromFile.expandByPoint(geometry.boundingBox.min);\n\t\t\t\t\t\t\t\t\tboxFromFile.expandByPoint(geometry.boundingBox.max);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t(geometry.morphTargets || []).concat([geometry]).forEach(({vertices}) => {\n\t\t\t\t\t\t\t\t\t(vertices || []).forEach((point) => {\n\t\t\t\t\t\t\t\t\t\tboxFromFile.expandByPoint(point);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\treturn boxFromFile;\n\t\t\t\t\t\t\t}).then(resolve, reject);\n\t\t\t\t\t\t} else if (U.isDefined(this.options.parts)) {\n\t\t\t\t\t\t\tP.all(this.children).map(part => part.originalBoundingBox).reduce((result, bbox) => {\n\t\t\t\t\t\t\t\treturn result.expandByPoint(bbox.min).expandByPoint(bbox.max);\n\t\t\t\t\t\t\t}, new THREE.Box3()).then(resolve, reject);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn this._originalBoundingBox;\n\t\t\t},\n\n\n\t\t\tget object3D() {\n\t\t\t\tif (!this._object3D) {\n\t\t\t\t\tthis._object3D = this.geometry3D.then((geometry3D) => {\n\n\t\t\t\t\t\tif (geometry3D) { // we have loaded a file\n\n\t\t\t\t\t\t\treturn this.rootThreeDModel.originalBoundingBox.then((originalBoundingBox) => {\n\n\t\t\t\t\t\t\t\t/* center the geometry based on the root model's bounding box */\n\t\t\t\t\t\t\t\tvar correction = originalBoundingBox.center().negate();\n\t\t\t\t\t\t\t\tvar correctionMatrix = new THREE.Matrix4().setPosition(correction);\n\t\t\t\t\t\t\t\t(geometry3D.morphTargets || []).forEach(({vertices}) => {\n\t\t\t\t\t\t\t\t\tvertices.forEach((point) => {\n\t\t\t\t\t\t\t\t\t\tpoint.applyMatrix4(correctionMatrix);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tgeometry3D.applyMatrix(correctionMatrix);\n\n\t\t\t\t\t\t\t\t/* create material */\n\t\t\t\t\t\t\t\tvar {animation, color} = this.options;\n\t\t\t\t\t\t\t\tvar material = new THREE.MeshLambertMaterial({ color: color || 'white' });\n\t\t\t\t\t\t\t\tmaterial.side = THREE.DoubleSide;\n\n\t\t\t\t\t\t\t\t/* create the object3D, either animated or not */\n\t\t\t\t\t\t\t\tvar object;\n\t\t\t\t\t\t\t\tif (animation) {\n\t\t\t\t\t\t\t\t\t/* create a mesh that can be animated */\n\t\t\t\t\t\t\t\t\tobject = new THREE.MorphAnimMesh(geometry3D, material);\n\t\t\t\t\t\t\t\t\tobject.duration = animation.duration;\n\t\t\t\t\t\t\t\t\tmaterial.morphTargets = true;\n\t\t\t\t\t\t\t\t\tgeometry3D.computeMorphNormals();\n\n\t\t\t\t\t\t\t\t\t/* subscribe to the clock */\n\t\t\t\t\t\t\t\t\tvar {clock} = this.options;\n\t\t\t\t\t\t\t\t\tvar lastTime = 0;\n\t\t\t\t\t\t\t\t\tclock.takeUntilBy(this.event('destroy')).onValue((time) => {\n\t\t\t\t\t\t\t\t\t\tobject.updateAnimation(1000 * (time - lastTime));\n\t\t\t\t\t\t\t\t\t\tlastTime = time;\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t/* simple, static mesh */\n\t\t\t\t\t\t\t\t\tobject = new THREE.Mesh(geometry3D, material);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tobject.castShadow = true;\n\t\t\t\t\t\t\t\tobject.receiveShadow = false;\n\n\t\t\t\t\t\t\t\treturn object;\n\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t} else { // this is a group with parts\n\n\t\t\t\t\t\t\t/* create base object3D for model parts */\n\t\t\t\t\t\t\tvar object = new THREE.Object3D();\n\n\t\t\t\t\t\t\t/* whenever each part is loaded, add them as a child of the base object */\n\t\t\t\t\t\t\tthis.children.map((part) => part.object3D).forEach((partObjectP) => {\n\t\t\t\t\t\t\t\tpartObjectP.then((partObject) => { object.add(partObject) });\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t/* resolve this promise with the base object */\n\t\t\t\t\t\t\treturn P.all(this.children.map((part) => part.object3D)).each((subObject) => {\n\t\t\t\t\t\t\t\tobject.add(subObject);\n\t\t\t\t\t\t\t}).return(object);\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn this._object3D;\n\t\t\t},\n\n\n\t\t\tadaptToSurfaceArea(size) {\n\n\t\t\t\tU.assert(this.rootThreeDModel === this,\n\t\t\t\t\t`The 'adaptToSurfaceArea' method should only be called on a root ThreeDModel.`);\n\n\t\t\t\tP.all([this.object3D, this.originalBoundingBox]).spread((obj, boundingBox) => {\n\t\t\t\t\t/* abbreviate 3D-object width and height */\n\t\t\t\t\tvar objWidth = boundingBox.size().x;\n\t\t\t\t\tvar objHeight = boundingBox.size().y;\n\n\t\t\t\t\t/* rotate 90° on the z-axis if this gives a better fit */\n\t\t\t\t\tif ((size.width < size.height) !== (objWidth < objHeight)) {\n\t\t\t\t\t\tobj.rotation.z = 0.5 * Math.PI;\n\t\t\t\t\t\t[objWidth, objHeight] = [objHeight, objWidth];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobj.rotation.z = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\t/* determine the scale ratio */\n\t\t\t\t\tvar ratio = 0.8 * Math.min(size.width / objWidth, size.height / objHeight);\n\n\t\t\t\t\t/* adjust size */\n\t\t\t\t\tobj.scale.set(ratio, ratio, ratio);\n\n\t\t\t\t\t/* any custom 'elevation' */\n\t\t\t\t\tvar elevation = U.defOr(this.options.elevation, Math.min(size.width, size.height) / 4);\n\t\t\t\t\tobj.position.z = 0.5 * ratio * boundingBox.size().z + elevation;\n\t\t\t\t});\n\n\t\t\t},\n\n\n\t\t\t_loadGeometryFromFile() {\n\n\t\t\t\t/* select the longest extension that fits the filename */\n\t\t\t\t// e.g., \"points.json\" has priority over \"json\"\n\t\t\t\tvar {file} = this.options;\n\t\t\t\tvar ext = '';\n\t\t\t\tObject.keys($.circuitboard.Circuitboard.threeJsLoaders).forEach((extension) => {\n\t\t\t\t\tif (extension.length > ext.length) {\n\t\t\t\t\t\tif (endsWith(file, `.${extension}`)) {\n\t\t\t\t\t\t\text = extension;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t/* was an extension found? */\n\t\t\t\tU.assert(ext.length > 0, `The file '${file}' is not recognized as a 3D model.`);\n\n\t\t\t\t/* fetch the loader for that file extension */\n\t\t\t\tvar Loader = $.circuitboard.Circuitboard.threeJsLoaders[ext];\n\n\t\t\t\t/* sanity check */\n\t\t\t\tU.assert(U.isDefined(Loader), `Something went wrong retrieving the 3D model loader.`);\n\n\t\t\t\t/* return a promise to the 3D object */\n\t\t\t\treturn U.promisify(new Loader(), 'load')(file).then((geometry) => {\n\n\t\t\t\t\t/* for now, we only accept Geometry's and Object3D's from a loader */\n\t\t\t\t\tU.assert(isGeometry(geometry) || isObject3D(geometry),\n\t\t\t\t\t\t`The 3D model loader for the '${ext}' extension returned an unsupported value.`);\n\n\t\t\t\t\t/* if an Object3D is returned, take only its geometry */\n\t\t\t\t\tif (!isGeometry(geometry)) { geometry = geometry.geometry || geometry.children[0].geometry }\n\n\t\t\t\t\t/* return the object */\n\t\t\t\t\treturn geometry;\n\n\t\t\t\t});\n\t\t\t},\n\n\n\t\t\t// UNCOMMENT THIS FOR HELP DEBUGGING OBJECT PLACEMENT\n\t\t\t//_showVisibleBoundingBox() {\n\t\t\t//\tif (this.rootThreeDModel === this) {\n\t\t\t//\t\tvar geometry = new THREE.BoxGeometry(1, 1, 1);\n\t\t\t//\t\tvar material = new THREE.MeshBasicMaterial({ color: 0x00ff00, wireframe: true });\n\t\t\t//\t\tvar box = new THREE.Mesh(geometry, material);\n\t\t\t//\t\tthis.object3D.then((object3D) => { object3D.add(box) });\n\t\t\t//\t\tthis.originalBoundingBox.then((bb) => {\n\t\t\t//\t\t\tif (bb.empty()) { return }\n\t\t\t//\t\t\tbox.position.x = 0.5 * (bb.max.x + bb.min.x);\n\t\t\t//\t\t\tbox.position.y = 0.5 * (bb.max.y + bb.min.y);\n\t\t\t//\t\t\tbox.position.z = 0.5 * (bb.max.z + bb.min.z);\n\t\t\t//\t\t\tbox.scale.x = (bb.max.x - bb.min.x);\n\t\t\t//\t\t\tbox.scale.y = (bb.max.y - bb.min.y);\n\t\t\t//\t\t\tbox.scale.z = (bb.max.z - bb.min.z);\n\t\t\t//\t\t});\n\t\t\t//\t}\n\t\t\t//},\n\n\n\t\t}, {\n\n\t\t\tvisible: false\n\n\t\t});\n\n\n\t\t/* static location to collect three.js loaders for different file formats */\n\t\t// TODO: transfer this task from Circuitboard to here, everywhere in the code\n\t\twindow._amy_ThreeDModel.loaders = {};\n\n\n\t\treturn window._amy_ThreeDModel;\n\n\n\t}).tap((c) => { $.circuitboard.ThreeDModel = c });\n\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/ThreeDModel.es6.js\n **/","define([\n\t'jquery',\n\t'three-js',\n\t'bluebird',\n\t'../util/kefir-and-eggs.es6.js',\n\t'../util/misc.es6.js',\n\t'../ThreeDModel.es6.js'\n], function ($, THREE, P, Kefir, U, ThreeDModelP) {\n\t'use strict';\n\n\n\t/* the plugin */\n\tvar plugin = $.circuitboard.plugin.do('three-d-geometric-models', {\n\t\trequires: ['three-d', 'three-d-spinner']\n\t});\n\n\n\t/* an object where three.js loaders for different file formats can be plugged in */\n\tplugin.add('Circuitboard.threeJsLoaders', {});\n\n\n\t/* to load any 3D models associated with a tile */\n\tplugin.add('Tile.prototype.loadThreeDModels', function () {\n\t\tvar threeDModels = this.circuitboard.options.threeDModels || {};\n\t\tif (!threeDModels) { return }\n\t\treturn P.all([this.model, ThreeDModelP]).spread((tileModel, ThreeDModel) => {\n\t\t\tif (threeDModels[tileModel.id]) {\n\t\t\t\tthis.threeDModels = {};\n\t\t\t\tObject.keys(threeDModels[tileModel.id]).forEach((modelID) => {\n\n\t\t\t\t\t/* create a simple clock for animated models */\n\t\t\t\t\t// TODO: at some point, we change this to a more global clock\n\t\t\t\t\tvar clock = new THREE.Clock();\n\t\t\t\t\tvar clockStream = Kefir.animationFrames().map(() => clock.getElapsedTime());\n\n\t\t\t\t\t/* create the model artefact */\n\t\t\t\t\tvar model = this.threeDModels[modelID] =\n\t\t\t\t\t\tnew ThreeDModel(U.extend({}, threeDModels[tileModel.id][modelID], {\n\t\t\t\t\t\t\tid:      modelID,\n\t\t\t\t\t\t\tparent:  this,\n\t\t\t\t\t\t\tclock:   clockStream,\n\t\t\t\t\t\t\tvisible: false\n\t\t\t\t\t\t}));\n\n\t\t\t\t\t/* when the object is created, add it to the scene and dynamically resize */\n\t\t\t\t\tmodel.object3D.then((object) => {\n\t\t\t\t\t\tthis.object3D.add(object);\n\t\t\t\t\t\tthis.p('size').onValue((size) => {\n\t\t\t\t\t\t\tthis.threeDModels[modelID].adaptToSurfaceArea(size);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\t/* loading indicator until the model is loaded */\n\t\t\t\t\tmodel.p('visible').value(true).take(1).onValue(() => {\n\t\t\t\t\t\tthis.loadingIndicator({ until: model.object3D });\n\t\t\t\t\t});\n\n\t\t\t\t});\n\t\t\t\treturn this.threeDModels;\n\t\t\t}\n\t\t});\n\t});\n\n\n\t/* load any 3D models associated with a tile */\n\tplugin.append('Tile.prototype.construct', function () {\n\t\tthis.loadThreeDModels();\n\t});\n\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/features/p-three-d-geometric-models.es6.js\n **/"],"sourceRoot":""}
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("jquery"),require("bluebird"),require("js-graph"));else if("function"==typeof define&&define.amd)define(["jquery","bluebird","js-graph"],t);else{var n="object"==typeof exports?t(require("jquery"),require("bluebird"),require("js-graph")):t(e.jQuery,e.P,e.JsGraph);for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(this,function(e,t,n){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var o,r;o=[n(1),n(2),n(3),n(4),n(5)],r=function(e,t,n,o,r){"use strict";function i(){a.vp("Circuitboard",n("Circuitboard",{cssClass:"circuitboard",filter:function(){return t.resolve(!0)},model:null})),a.vp("Tilemap",n("Tilemap",{cssClass:"tilemap",model:null,_circuitboard:null})),a.vp("Tile",n("Tile",{cssClass:"tile",model:null,_circuitboard:null}))}r.registerPromiseResolver(t.resolve);var a=new r;return o.extend(o.object(e,"circuitboard"),{plugin:function(t){return e.isPlainObject(t)?new a.Delta(t.name,t):(a.select.apply(a,t),void i())}}),e.circuitboard.plugin.graph=function(){return a.graph()},e.circuitboard}.apply(t,o),!(void 0!==r&&(e.exports=r))},function(t){t.exports=e},function(e){e.exports=t},function(e,t,n){var o,r;o=[n(1),n(2),n(4)],r=function(e,t,n){"use strict";function o(t){function n(t){return o[t]||(o[t]=e.Callbacks()),o[t]}var o={};e.extend(t,{on:function(e,t){n(e).add(t)},off:function(e,t){n(e).remove(t)},one:function(e,t){var n=arguments,o=this,r=function(){t.apply(null,n),o.off(e,r)};this.on(e,r)},once:function(e,t){this.one(e,t)},trigger:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=o[e];r&&r.fireWith(this,t)}})}function r(t,o){Object.defineProperty(t,"type",{get:function(){return o}}),Object.defineProperty(t,"parent",{set:function(e){this._parent=e,n.array(e,"_children").push(this)},get:function(){return this._parent}}),Object.defineProperty(t,"children",{get:function(){return this._children}}),e.extend(t,{closestAncestorByType:function(e){var t=this;do t=t.parent;while(t&&t.type&&t.type!==e);return t},closestDescendantsByType:function(e){var t=[];return(this.children||[]).forEach(function(n){n.type===e?t.push(n):t=t.concat(n.closestDescendantsByType(e))}),t}})}function i(e){Object.defineProperty(e,"model",{get:function(){return this.options.model}})}function a(n,a){function s(n){var r=n,i=r.options,s=r.element,u=this;e.extend(this,{options:e.extend({},a,i),element:s,destroy:function(){this.trigger("destroy")}}),o(this),this.element.addClass(this.options.cssClass),this.element.one("remove",function(){u.destroy()}),this.options.parent&&(this.parent=this.options.parent),Object.defineProperty(this,"circuitboard",{get:function(){return this.closestAncestorByType("Circuitboard")}}),this.constructed=t.resolve(),this.beforeConstruction(this.options.beforeConstruction),this.constructed.then(function(){e.isFunction(u.construct)&&u.beforeConstruction(u.construct())})}s.prototype.beforeConstruction=function(e){this.constructed=this.constructed.return(t.resolve(e)).return(this)},i(s.prototype),r(s.prototype,n);var u=n[0].toLowerCase()+n.slice(1);return e.fn[u]=function(e){if("instance"===e)return this.data("-amy-"+u);var t=new s({options:e,element:this});return this.data("-amy-"+u,t.constructed),this},s}return a}.apply(t,o),!(void 0!==r&&(e.exports=r))},function(e,t,n){var o;o=function(){"use strict";var e={newClass:function(e,t){t=t||{};var n=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.apply(this,t)};return n.prototype=t,n.prototype.constructor=n,n},newSubclass:function(e,t,n){n=n||{};var o=function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];t.apply(this,[e.prototype.constructor].concat(n))};return o.prototype=Object.create(e.prototype,n),o.prototype.constructor=o,o},extend:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.forEach(function(t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}),e},field:function(e){return function(t){return t[e]}},object:function(t,n){return e.isUndefined(t[n])&&(t[n]={}),t[n]},array:function(t,n){return e.isUndefined(t[n])&&(t[n]=[]),t[n]},pull:function(e,t){var n=e.indexOf(t);-1!==n&&e.splice(n)},makeEmpty:function(e){for(;e.length>0;)e.pop()},bindA:function(e,t,n){return e.bind.apply(e,[t].concat(n))},bind:function(t,n){for(var o=[],r=2;r<arguments.length;r++)o[r-2]=arguments[r];return e.bindA(t[n],t,o)},applyConstructor:function(e,t){var n=e.bind.apply(e,[null].concat(t));return new n},assert:function(e,t){if(!e)throw new Error(t||"Assertion failed")},isUndefined:function(e){return"undefined"==typeof e},isDefined:function(e){return"undefined"!=typeof e},objValues:function(e){return Object.keys(e).map(function(t){return e[t]})},makePositioned:function(e){"static"===e.css("position")&&e.css("position","relative")},defOr:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var o=0;o<t.length;o+=1)if(e.isDefined(t[o]))return t[o]},debounce:function(e,t,n){var o;return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var a=function(){o=null,e.apply(n,r)};clearTimeout(o),o=setTimeout(a,t)}},eachAnimationFrame:function(e,t){function n(){e.apply(t),o||requestAnimationFrame(n)}var o=!1;return n(),function(){o=!0}},oncePerStack:function(e,t){var n=!0;return function(){for(var o=[],r=0;r<arguments.length;r++)o[r]=arguments[r];n&&(n=!1,setTimeout(function(){n=!0},0),e.apply(t,o))}},observable:function(e,t){var n=t,o=n.name,r=n.initial,i=n.validation,a=r;Object.defineProperty(e,o,{get:function(){return a},set:function(e){var t=a;i&&(e=i(e,t)),e!==t&&(a=e,this.trigger(o,e,t))}})},cached:function(t){function n(){var e=o;o=r(),a&&!i(o,e)&&a(o,e)}var o,r=t.retrieve,i=t.isEqual||function(e,t){return e===t};setTimeout(n,0);var a,s=e.oncePerStack(n),u=function(){return s(),o};return u.onChange=function(e){return a=e,u},u}};return e}.call(t,n,t,e),!(void 0!==o&&(e.exports=o))},function(e,t,n){var o,r;o=[n(6),n(4)],r=function(e,t){"use strict";function n(e,n){t.assert("function"==typeof e,"The operation '"+n+"' expects the property it acts on to be a function.")}function o(e,n){t.assert(t.isDefined(e),"The operation '"+n+"' expects the property to be defined.")}function r(e,n){t.assert(t.isUndefined(e),"The operation '"+n+"' expects the property to be undefined.")}var i=function(){},a=function(e,t,n){e[t]=n},s=function(e,t,n){n.applyTo(e[t],"value")},u=t.newClass(function(){function f(e,n){b=!0,n===!0?g[e]=!0:n===!1||v[e]!==!0&&t.array(v,e).push(n)}function p(){if(b){b=!1;var e;do e=!1,m.eachVertex(function(n){g[n]||t.isUndefined(v[n])||v[n].some(function(e){return e.every(function(e){return g[e]})})&&(g[n]=!0,e=!0)});while(e)}}var l=this,d={},h=[];t.extend(this,{_addOperationType:function(e){var n=e,o=n.name,r=n.constructor,i=n.applyTo,a=n.prototype,s=n.method,u={};d[o]={name:o,Delta:r,method:u[o]},t.extend(d[o].Delta.prototype,a,{constructor:r,type:o,applyTo:i,compose:function(e,n){var o=this;if(t.isUndefined(n))return this;var r;if(h.some(function(e){var t=e,i=t.op1Type,a=t.op2Type,s=t.composeFn;return o.type===i&&n.type===a?(r=s,!0):void 0}),!r){var i=new Error("You cannot follow a '"+this.type+"' operation "+("with a '"+n.type+"' operation on the same property."));throw i.op1=this.type,i.op2=n.type,i}r(this,e,n)}}),d.modify.Delta.prototype[o]=t.isDefined(s)?s:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this._addOperation(d[o],e,t),this}},_addOperationAlias:function(e){var t=e,n=t.name,o=t.target,r=t.transform,i={};Object.defineProperty(i,n,{value:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this._addOperation(d[o],e,r(t)),this}}),d[n]={name:n,method:i[n]},d.modify.Delta.prototype[n]=d[n].method},_addCompositionRule:function(e,t,n){h.push({op1Type:e,op2Type:t,composeFn:n})},_newDelta:function(e){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];return t.applyConstructor(d[e].Delta,n)}});var y=this;this._addOperationType({name:"modify",constructor:function(e,n){var o=this;e=e||{},this.operations=n||{},Object.keys(e).forEach(function(n){var r=n.match(/^(\w+)\s+([\w\.]+)$/);if(r){var i=r[1],a=r[2];t.assert(i in d,"I don't know the '"+i+"' operation."),o[i](a,e[n])}})},applyTo:function(e,n){var o=this;t.isDefined(n)?(t.assert(t.isDefined(e[n]),"The 'modify' operation expects the property to be already defined."),Object.keys(this.operations).forEach(function(t){o.operations[t].applyTo(e[n],t)})):(t.assert(t.isDefined(e),"The 'modify' operation expects the property to be already defined."),Object.keys(this.operations).forEach(function(t){o.operations[t].applyTo(e,t)}))},prototype:{selectivelyApplyTo:function(e,n){t.assert(t.isDefined(e),"The 'modify' operation expects the property to be already defined."),t.isDefined(this.operations[n])&&this.operations[n].applyTo(e,n)},_addOperation:function(e,n,o){var r=n.indexOf(".");if(-1!==r){var i=n.slice(0,r),a=n.slice(r+1),s=this._addOperation(d.modify,i);return s[e.name].apply(s,[a].concat(o))}var u=y._newDelta.apply(y,[e.name].concat(o));return this.operations.hasOwnProperty(n)&&t.isDefined(this.operations[n])?this.compose(n,u):this.operations[n]=u,this.operations[n]}},method:function(e,t){return this._addOperation(d.modify,e,[t])}}),this._addOperationType({name:"add",constructor:function(e){this.value=e},applyTo:function(e,t){r(e[t],"add"),e[t]=this.value}}),this._addOperationType({name:"replace",constructor:function(e){this.value=e},applyTo:function(e,t){o(e[t],"replace"),e[t]=this.value}}),this._addOperationType({name:"remove",constructor:function(){},applyTo:function(e,t){o(e[t],"remove"),delete e[t]}}),this._addOperationType({name:"forbid",constructor:function(){},applyTo:function(e,t){r(e[t],"forbid")}}),this._addCompositionRule("add","replace",function(e,t,n){e[t]=u._newDelta("add",n.value)}),this._addCompositionRule("add","modify",s),this._addCompositionRule("add","remove",function(e,t){e[t]=u._newDelta("forbid")}),this._addCompositionRule("replace","replace",a),this._addCompositionRule("replace","modify",s),this._addCompositionRule("replace","remove",a),this._addCompositionRule("modify","replace",a),this._addCompositionRule("modify","modify",function(e,t,n){Object.keys(n.operations).forEach(function(t){e.compose(t,n.operations[t])})}),this._addCompositionRule("modify","remove",a),this._addCompositionRule("remove","add",function(e,t,n){e[t]=u._newDelta("replace",n.value)}),this._addCompositionRule("remove","forbid",i),this._addCompositionRule("forbid","add",a),this._addCompositionRule("forbid","forbid",i),this._addOperationType({name:"alter",constructor:function(e,t){this.value=e||[],this.alias=t||"alter"},applyTo:function(e,t){n(e[t],this.alias),this.value.forEach(function(n){var o=e[t],r=n.value;e[t]="prepend"===n.type?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.apply(this,e),o.apply(this,e)}:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.apply(this,e),r.apply(this,e)}})}}),this._addCompositionRule("alter","alter",function(e,t,n){[].push.apply(e[t].value,n.value)}),this._addCompositionRule("alter","replace",a),this._addCompositionRule("alter","remove",function(e,t){e[t]=u._newDelta("forbid")}),this._addCompositionRule("add","alter",function(e,t,o){n(e[t].value,o.alias),s(e,t,o)}),this._addCompositionRule("replace","alter",function(e,t,o){n(e[t].value,o.alias),s(e,t,o)}),["prepend","insert","append"].forEach(function(e){l._addOperationAlias({name:e,target:"alter",transform:function(t){return[[{type:e,value:t[0]}],e]}})}),this._addOperationType({name:"after",constructor:function(e){t.assert("function"==typeof c,"Before creating an 'after' operation, you must register a promise resolver to delta.js."),this.value=e},applyTo:function(e,t){n(e[t],"after");var o=e[t],r=this.value;e[t]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return c(o.apply(this,e)).then(function(){return r.apply(this,e)}.bind(this))}}}),this._addCompositionRule("after","replace",a),this._addCompositionRule("after","remove",a),this._addCompositionRule("add","after",function(e,t,o){n(e[t].value,"after"),s(e,t,o)}),this._addCompositionRule("replace","after",function(e,t,o){n(e[t].value,"after"),s(e,t,o)}),this._addCompositionRule("insert","after",s),this._addCompositionRule("after","insert",s);var m=new e;t.extend(this,{graph:function(){return m}});var v={},g={},b=!1;this.Delta=t.newSubclass(d.modify.Delta,function(e,n,o){e.call(this,o),t.assert(o instanceof Object,"A delta should be given as an object."),d.modify.Delta.apply(this,o),Object.defineProperties(this,{name:{get:function(){return n}},manuallySelectable:{get:function(){return t.isDefined(o.manuallySelectable)?!!o.manuallySelectable:t.isDefined(o.resolves)&&o.resolves.length>0?!1:!0}},selected:{get:function(){return p(),!!g[n]}},"if":{get:function(){return o["if"]===!0||o["if"]===!1?o["if"]:o["if"]||o.iff||o.resolves?[].concat(o["if"]||[],o.iff||[],o.resolves||[]):!1}},onlyIf:{get:function(){return o.onlyIf===!0||o.onlyIf===!1?o.onlyIf:o.onlyIf||o.iff||o.expects||o.resolves?[].concat(o.onlyIf||[],o.iff||[],o.expects||[],o.resolves||[]):!0}},after:{get:function(){return[].concat(o.after||[],o.expects||[],o.resolves||[],o.requires||[])}},selects:{get:function(){return[].concat(o.selects||[],o.requires||[])}}}),b=!0,t.isDefined(this.if)&&f(n,this.if),this.selects.forEach(function(e){f(e,[n])}),m.addVertex(n,this),this.after.forEach(function(e){m.createEdge(e,n)}),t.assert(!m.hasCycle(),"The delta "+n+" introduced a cycle in the application order.")}),t.extend(this,{select:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.forEach(function(e){f(e,!0)})},vp:function(e,n){var o={};return o[e]=n,p(),m.eachVertex(function(e,n){t.assert(!n.selected||n.onlyIf===!0||n.onlyIf.every(function(e){return m.vertexValue(e).selected}),"The 'onlyIf' condition of delta '"+n.name+"' was violated.")}),m.topologically(function(t,n){n.selected&&n.selectivelyApplyTo(o,e)}),o[e]}})}),c=null;return t.extend(u,{registerPromiseResolver:function(e){c=e}}),u}.apply(t,o),!(void 0!==r&&(e.exports=r))},function(e){e.exports=n}])});
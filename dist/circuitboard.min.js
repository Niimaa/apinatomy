!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("jquery"),require("bluebird"),require("js-graph"));else if("function"==typeof define&&define.amd)define(["jquery","bluebird","js-graph"],e);else{var n="object"==typeof exports?e(require("jquery"),require("bluebird"),require("js-graph")):e(t.jQuery,t.P,t.JsGraph);for(var o in n)("object"==typeof exports?exports:t)[o]=n[o]}}(this,function(t,e,n){return function(t){function e(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return t[o].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){var o,i;o=[n(1),n(2),n(3),n(4),n(5)],i=function(t,e,n,o,i){"use strict";function r(){a.vp("Circuitboard",n("Circuitboard",{cssClass:"circuitboard",filter:function(){return e.resolve(!0)},model:null})),a.vp("Tilemap",n("Tilemap",{cssClass:"tilemap",model:null,_circuitboard:null})),a.vp("Tile",n("Tile",{cssClass:"tile",model:null,_circuitboard:null}))}i.registerPromiseResolver(e.resolve);var a=new i;return o.extend(o.object(t,"circuitboard"),{plugin:function(e){return t.isPlainObject(e)?new a.Delta(e.name,e):(a.select.apply(a,e),void r())}}),t.circuitboard.plugin.graph=function(){return a.graph()},t.circuitboard}.apply(e,o),!(void 0!==i&&(t.exports=i))},function(e){e.exports=t},function(t){t.exports=e},function(t,e,n){var o,i;o=[n(1),n(2),n(4)],i=function(t,e,n){"use strict";function o(e){function n(e){return o[e]||(o[e]=t.Callbacks()),o[e]}var o={};t.extend(e,{on:function(t,e){n(t).add(e)},off:function(t,e){n(t).remove(e)},one:function(t,e){var n=arguments,o=this,i=function(){e.apply(null,n),o.off(t,i)};this.on(t,i)},once:function(t,e){this.one(t,e)},trigger:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=o[t];i&&i.fireWith(this,e)}})}function i(e,o){Object.defineProperty(e,"type",{get:function(){return o}}),Object.defineProperty(e,"parent",{set:function(t){this._parent=t,n.array(t,"_children").push(this)},get:function(){return this._parent}}),Object.defineProperty(e,"children",{get:function(){return this._children}}),t.extend(e,{closestAncestorByType:function(t){var e=this;do e=e.parent;while(e&&e.type&&e.type!==t);return e},closestDescendantsByType:function(t){var e=[];return(this.children||[]).forEach(function(n){n.type===t?e.push(n):e=e.concat(n.closestDescendantsByType(t))}),e}})}function r(t){Object.defineProperty(t,"model",{get:function(){return this.options.model}})}function a(n,a){function s(n){var i=n,r=i.options,s=i.element,u=this;t.extend(this,{options:t.extend({},a,r),element:s,destroy:function(){this.trigger("destroy")}}),o(this),this.element.addClass(this.options.cssClass),this.element.one("remove",function(){u.destroy()}),this.options.parent&&(this.parent=this.options.parent),Object.defineProperty(this,"circuitboard",{get:function(){return this.closestAncestorByType("Circuitboard")}}),this.constructed=e.resolve(),this.beforeConstruction(this.options.beforeConstruction),this.constructed.then(function(){t.isFunction(u.construct)&&u.beforeConstruction(u.construct())})}s.prototype.beforeConstruction=function(t){this.constructed=this.constructed.return(e.resolve(t)).return(this)},r(s.prototype),i(s.prototype,n);var u=n[0].toLowerCase()+n.slice(1);return t.fn[u]=function(t){if("instance"===t)return this.data("-amy-"+u);var e=new s({options:t,element:this});return this.data("-amy-"+u,e.constructed),this},s}return a}.apply(e,o),!(void 0!==i&&(t.exports=i))},function(t,e,n){var o;o=function(){"use strict";var t={newClass:function(t,e){e=e||{};var n=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.apply(this,e)};return n.prototype=e,n.prototype.constructor=n,n},newSubclass:function(t,e,n){n=n||{};var o=function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];e.apply(this,[t.prototype.constructor].concat(n))};return o.prototype=Object.create(t.prototype,n),o.prototype.constructor=o,o},extend:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return e.forEach(function(e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}),t},field:function(t){return function(e){return e[t]}},object:function(e,n){return t.isUndefined(e[n])&&(e[n]={}),e[n]},array:function(e,n){return t.isUndefined(e[n])&&(e[n]=[]),e[n]},pull:function(t,e){var n=t.indexOf(e);-1!==n&&t.splice(n)},makeEmpty:function(t){for(;t.length>0;)t.pop()},bindA:function(t,e,n){return t.bind.apply(t,[e].concat(n))},bind:function(e,n){for(var o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];return t.bindA(e[n],e,o)},applyConstructor:function(t,e){var n=t.bind.apply(t,[null].concat(e));return new n},assert:function(t,e){if(!t)throw new Error(e||"Assertion failed")},isUndefined:function(t){return"undefined"==typeof t},isDefined:function(t){return"undefined"!=typeof t},objValues:function(t){return Object.keys(t).map(function(e){return t[e]})},makePositioned:function(t){"static"===t.css("position")&&t.css("position","relative")},defOr:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var o=0;o<e.length;o+=1)if(t.isDefined(e[o]))return e[o]},debounce:function(t,e,n){var o;return function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];var a=function(){o=null,t.apply(n,i)};clearTimeout(o),o=setTimeout(a,e)}},eachAnimationFrame:function(t,e){function n(){t.apply(e),o||requestAnimationFrame(n)}var o=!1;return n(),function(){o=!0}},oncePerStack:function(t,e){var n=!0;return function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];n&&(n=!1,setTimeout(function(){n=!0},0),t.apply(e,o))}},observable:function(t,e){var n=e,o=n.name,i=n.initial,r=n.validation,a=i;Object.defineProperty(t,o,{get:function(){return a},set:function(t){var e=a;r&&(t=r(t,e)),t!==e&&(a=t,this.trigger(o,t,e))}})},cached:function(e){function n(){var t=o;o=i(),a&&!r(o,t)&&a(o,t)}var o,i=e.retrieve,r=e.isEqual||function(t,e){return t===e};setTimeout(n,0);var a,s=t.oncePerStack(n),u=function(){return s(),o};return u.onChange=function(t){return a=t,u},u}};return t.Position=t.newClass(function(t,e){this.top=t,this.left=e}),t.Position.subtract=function(e,n){return new t.Position(e.top-n.top,e.left-n.left)},t.Position.equals=function(t,e){return t&&e&&t.top===e.top&&t.left===e.left},t.Size=t.newClass(function(t,e){this.height=t,this.width=e}),t.Position.equals=function(t,e){return t&&e&&t.height===e.height&&t.width===e.width},t}.call(e,n,e,t),!(void 0!==o&&(t.exports=o))},function(t,e,n){var o,i;o=[n(6),n(4)],i=function(t,e){"use strict";function n(t,n){e.assert("function"==typeof t,"The operation '"+n+"' expects the property it acts on to be a function.")}function o(t,n){e.assert(e.isDefined(t),"The operation '"+n+"' expects the property to be defined.")}function i(t,n){e.assert(e.isUndefined(t),"The operation '"+n+"' expects the property to be undefined.")}var r=function(){},a=function(t,e,n){t[e]=n},s=function(t,e,n){n.applyTo(t[e],"value")},u=e.newClass(function(){function f(t,n){b=!0,n===!0?g[t]=!0:n===!1||v[t]!==!0&&e.array(v,t).push(n)}function p(){if(b){b=!1;var t;do t=!1,m.eachVertex(function(n){g[n]||e.isUndefined(v[n])||v[n].some(function(t){return t.every(function(t){return g[t]})})&&(g[n]=!0,t=!0)});while(t)}}var l=this,d={},h=[];e.extend(this,{_addOperationType:function(t){var n=t,o=n.name,i=n.constructor,r=n.applyTo,a=n.prototype,s=n.method,u={};d[o]={name:o,Delta:i,method:u[o]},e.extend(d[o].Delta.prototype,a,{constructor:i,type:o,applyTo:r,compose:function(t,n){var o=this;if(e.isUndefined(n))return this;var i;if(h.some(function(t){var e=t,r=e.op1Type,a=e.op2Type,s=e.composeFn;return o.type===r&&n.type===a?(i=s,!0):void 0}),!i){var r=new Error("You cannot follow a '"+this.type+"' operation "+("with a '"+n.type+"' operation on the same property."));throw r.op1=this.type,r.op2=n.type,r}i(this,t,n)}}),d.modify.Delta.prototype[o]=e.isDefined(s)?s:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return this._addOperation(d[o],t,e),this}},_addOperationAlias:function(t){var e=t,n=e.name,o=e.target,i=e.transform,r={};Object.defineProperty(r,n,{value:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return this._addOperation(d[o],t,i(e)),this}}),d[n]={name:n,method:r[n]},d.modify.Delta.prototype[n]=d[n].method},_addCompositionRule:function(t,e,n){h.push({op1Type:t,op2Type:e,composeFn:n})},_newDelta:function(t){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];return e.applyConstructor(d[t].Delta,n)}});var y=this;this._addOperationType({name:"modify",constructor:function(t,n){var o=this;t=t||{},this.operations=n||{},Object.keys(t).forEach(function(n){var i=n.match(/^(\w+)\s+([\w\.]+)$/);if(i){var r=i[1],a=i[2];e.assert(r in d,"I don't know the '"+r+"' operation."),o[r](a,t[n])}})},applyTo:function(t,n){var o=this;e.isDefined(n)?(e.assert(e.isDefined(t[n]),"The 'modify' operation expects the property to be already defined."),Object.keys(this.operations).forEach(function(e){o.operations[e].applyTo(t[n],e)})):(e.assert(e.isDefined(t),"The 'modify' operation expects the property to be already defined."),Object.keys(this.operations).forEach(function(e){o.operations[e].applyTo(t,e)}))},prototype:{selectivelyApplyTo:function(t,n){e.assert(e.isDefined(t),"The 'modify' operation expects the property to be already defined."),e.isDefined(this.operations[n])&&this.operations[n].applyTo(t,n)},_addOperation:function(t,n,o){var i=n.indexOf(".");if(-1!==i){var r=n.slice(0,i),a=n.slice(i+1),s=this._addOperation(d.modify,r);return s[t.name].apply(s,[a].concat(o))}var u=y._newDelta.apply(y,[t.name].concat(o));return this.operations.hasOwnProperty(n)&&e.isDefined(this.operations[n])?this.compose(n,u):this.operations[n]=u,this.operations[n]}},method:function(t,e){return this._addOperation(d.modify,t,[e])}}),this._addOperationType({name:"add",constructor:function(t){this.value=t},applyTo:function(t,e){i(t[e],"add"),t[e]=this.value}}),this._addOperationType({name:"replace",constructor:function(t){this.value=t},applyTo:function(t,e){o(t[e],"replace"),t[e]=this.value}}),this._addOperationType({name:"remove",constructor:function(){},applyTo:function(t,e){o(t[e],"remove"),delete t[e]}}),this._addOperationType({name:"forbid",constructor:function(){},applyTo:function(t,e){i(t[e],"forbid")}}),this._addCompositionRule("add","replace",function(t,e,n){t[e]=u._newDelta("add",n.value)}),this._addCompositionRule("add","modify",s),this._addCompositionRule("add","remove",function(t,e){t[e]=u._newDelta("forbid")}),this._addCompositionRule("replace","replace",a),this._addCompositionRule("replace","modify",s),this._addCompositionRule("replace","remove",a),this._addCompositionRule("modify","replace",a),this._addCompositionRule("modify","modify",function(t,e,n){Object.keys(n.operations).forEach(function(e){t.compose(e,n.operations[e])})}),this._addCompositionRule("modify","remove",a),this._addCompositionRule("remove","add",function(t,e,n){t[e]=u._newDelta("replace",n.value)}),this._addCompositionRule("remove","forbid",r),this._addCompositionRule("forbid","add",a),this._addCompositionRule("forbid","forbid",r),this._addOperationType({name:"alter",constructor:function(t,e){this.value=t||[],this.alias=e||"alter"},applyTo:function(t,e){n(t[e],this.alias),this.value.forEach(function(n){var o=t[e],i=n.value;t[e]="prepend"===n.type?function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];i.apply(this,t),o.apply(this,t)}:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];o.apply(this,t),i.apply(this,t)}})}}),this._addCompositionRule("alter","alter",function(t,e,n){[].push.apply(t[e].value,n.value)}),this._addCompositionRule("alter","replace",a),this._addCompositionRule("alter","remove",function(t,e){t[e]=u._newDelta("forbid")}),this._addCompositionRule("add","alter",function(t,e,o){n(t[e].value,o.alias),s(t,e,o)}),this._addCompositionRule("replace","alter",function(t,e,o){n(t[e].value,o.alias),s(t,e,o)}),["prepend","insert","append"].forEach(function(t){l._addOperationAlias({name:t,target:"alter",transform:function(e){return[[{type:t,value:e[0]}],t]}})}),this._addOperationType({name:"after",constructor:function(t){e.assert("function"==typeof c,"Before creating an 'after' operation, you must register a promise resolver to delta.js."),this.value=t},applyTo:function(t,e){n(t[e],"after");var o=t[e],i=this.value;t[e]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return c(o.apply(this,t)).then(function(){return i.apply(this,t)}.bind(this))}}}),this._addCompositionRule("after","replace",a),this._addCompositionRule("after","remove",a),this._addCompositionRule("add","after",function(t,e,o){n(t[e].value,"after"),s(t,e,o)}),this._addCompositionRule("replace","after",function(t,e,o){n(t[e].value,"after"),s(t,e,o)}),this._addCompositionRule("insert","after",s),this._addCompositionRule("after","insert",s);var m=new t;e.extend(this,{graph:function(){return m}});var v={},g={},b=!1;this.Delta=e.newSubclass(d.modify.Delta,function(t,n,o){t.call(this,o),e.assert(o instanceof Object,"A delta should be given as an object."),d.modify.Delta.apply(this,o),Object.defineProperties(this,{name:{get:function(){return n}},manuallySelectable:{get:function(){return e.isDefined(o.manuallySelectable)?!!o.manuallySelectable:e.isDefined(o.resolves)&&o.resolves.length>0?!1:!0}},selected:{get:function(){return p(),!!g[n]}},"if":{get:function(){return o["if"]===!0||o["if"]===!1?o["if"]:o["if"]||o.iff||o.resolves?[].concat(o["if"]||[],o.iff||[],o.resolves||[]):!1}},onlyIf:{get:function(){return o.onlyIf===!0||o.onlyIf===!1?o.onlyIf:o.onlyIf||o.iff||o.expects||o.resolves?[].concat(o.onlyIf||[],o.iff||[],o.expects||[],o.resolves||[]):!0}},after:{get:function(){return[].concat(o.after||[],o.expects||[],o.resolves||[],o.requires||[])}},selects:{get:function(){return[].concat(o.selects||[],o.requires||[])}}}),b=!0,e.isDefined(this.if)&&f(n,this.if),this.selects.forEach(function(t){f(t,[n])}),m.addVertex(n,this),this.after.forEach(function(t){m.createEdge(t,n)}),e.assert(!m.hasCycle(),"The delta "+n+" introduced a cycle in the application order.")}),e.extend(this,{select:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.forEach(function(t){f(t,!0)})},vp:function(t,n){var o={};return o[t]=n,p(),m.eachVertex(function(t,n){e.assert(!n.selected||n.onlyIf===!0||n.onlyIf.every(function(t){return m.vertexValue(t).selected}),"The 'onlyIf' condition of delta '"+n.name+"' was violated.")}),m.topologically(function(e,n){n.selected&&n.selectivelyApplyTo(o,t)}),o[t]}})}),c=null;return e.extend(u,{registerPromiseResolver:function(t){c=t}}),u}.apply(e,o),!(void 0!==i&&(t.exports=i))},function(t){t.exports=n}])});
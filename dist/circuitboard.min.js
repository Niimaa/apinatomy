!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("jquery"),require("bluebird"),require("js-graph"));else if("function"==typeof define&&define.amd)define(["jquery","bluebird","js-graph"],t);else{var n="object"==typeof exports?t(require("jquery"),require("bluebird"),require("js-graph")):t(e.jQuery,e.P,e.JsGraph);for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(e,t,n){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var r,o;r=[n(1),n(2),n(3),n(4),n(5),n(6)],o=function(e,t,n,r,o,i){"use strict";var a=i(),s={Circuitboard:n("Circuitboard",{beforeConstruction:a.promise,cssClass:"circuitboard",filter:function(){return t.resolve(!0)},model:null}),Tilemap:n("Tilemap",{beforeConstruction:a.promise,cssClass:"tilemap",model:null,_circuitboard:null}),Tile:n("Tile",{beforeConstruction:a.promise,cssClass:"tile",model:null,_circuitboard:null})},u=new o;return r.object(e,"circuitboard").plugin=function(t){return e.isPlainObject(t)?u.register(t):(r.assert(r.isDefined(s),"The plugins are being selected before the circuitboard artefacts were registered. Have you loaded the ApiNATOMY files in a strange order?"),u.select(t),u.apply(s).then(a.resolve,a.reject).return())},e.circuitboard}.apply(t,r),!(void 0!==o&&(e.exports=o))},function(t){t.exports=e},function(e){e.exports=t},function(e,t,n){var r,o;r=[n(1),n(2),n(4)],o=function(e,t,n){"use strict";function r(t){function n(t){return r[t]||(r[t]=e.Callbacks()),r[t]}var r={};e.extend(t,{on:function(e,t){n(e).add(t)},off:function(e,t){n(e).remove(t)},one:function(e,t){var n=arguments,r=this,o=function(){t.apply(null,n),r.off(e,o)};this.on(e,o)},once:function(e,t){this.one(e,t)},trigger:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=r[e];o&&o.fireWith(this,t)}})}function o(t,r){Object.defineProperty(t,"type",{get:function(){return r}}),Object.defineProperty(t,"parent",{set:function(e){this._parent=e,n.array(e,"_children").push(this)},get:function(){return this._parent}}),Object.defineProperty(t,"children",{get:function(){return this._children}}),e.extend(t,{closestAncestorByType:function(e){var t=this;do t=t.parent;while(t&&t.type&&t.type!==e);return t},closestDescendantsByType:function(e){var t=[];return(this.children||[]).forEach(function(n){n.type===e?t.push(n):t=t.concat(n.closestDescendantsByType(e))}),t}})}function i(e){Object.defineProperty(e,"model",{get:function(){return this.options.model}})}function a(n,a){function s(n){var o=n,i=o.options,s=o.element,u=this;e.extend(this,{options:e.extend({},a,i),element:s,destroy:function(){this.trigger("destroy")}}),r(this),this.element.addClass(this.options.cssClass),this.element.one("remove",function(){u.destroy()}),this.options.parent&&(this.parent=this.options.parent),Object.defineProperty(this,"circuitboard",{get:function(){return this.closestAncestorByType("Circuitboard")}}),this.constructed=t.resolve(),this.beforeConstruction(this.options.beforeConstruction),this.constructed.then(function(){e.isFunction(u.construct)&&u.beforeConstruction(u.construct())})}s.prototype.beforeConstruction=function(e){this.constructed=this.constructed.return(t.resolve(e)).return(this)},i(s.prototype),o(s.prototype,n);var u=n[0].toLowerCase()+n.slice(1);return e.fn[u]=function(e){if("instance"===e)return this.data("-amy-"+u);var t=new s({options:e,element:this});return this.data("-amy-"+u,t.constructed),this},s}return a}.apply(t,r),!(void 0!==o&&(e.exports=o))},function(e,t,n){var r,o;r=[n(1)],o=function(e){"use strict";var t={approx:function(e,n,r){return t.isUndefined(r)&&(r=1e-5),Math.abs(e-n)<r},field:function(e){return function(t){return t[e]}},object:function(t,n){return e.isPlainObject(t[n])||(t[n]={}),t[n]},array:function(t,n){return e.isArray(t[n])||(t[n]=[]),t[n]},pull:function(e,t){var n=e.indexOf(t);-1!==n&&e.splice(n)},makeEmpty:function(e){for(;e.length>0;)e.pop()},bindA:function(e,t,n){return e.bind.apply(e,[t].concat(n))},bind:function(e,n){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];return t.bindA(e[n],e,r)},applyConstructor:function(e,t){var n=e.bind.apply(e,[null].concat(t));return new n},assert:function(e,t){if(!e)throw new Error(t||"Assertion failed")},isUndefined:function(e){return"undefined"==typeof e},isDefined:function(e){return"undefined"!=typeof e},objValues:function(e){return Object.keys(e).map(function(t){return e[t]})},makePositioned:function(e){"static"===e.css("position")&&e.css("position","relative")},defOr:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r=0;r<e.length;r+=1)if(t.isDefined(e[r]))return e[r]},debounce:function(e,t,n){var r;return function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];var a=function(){r=null,e.apply(n,o)};clearTimeout(r),r=setTimeout(a,t)}},eachAnimationFrame:function(e,t){function n(){e.apply(t),r||requestAnimationFrame(n)}var r=!1;return n(),function(){r=!0}},oncePerStack:function(e,t){var n=!0;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];n&&(n=!1,setTimeout(function(){n=!0},0),e.apply(t,r))}},observable:function(e,t){var n;Object.defineProperty(e,t.name,{get:function(){return n},set:function(e){if(e!==n){var r=n;n=e,this.trigger(t.name,e,r)}}})},cached:function(e){function n(){var e=r;r=o(),a&&!i(r,e)&&a(r,e)}var r,o=e.retrieve,i=e.isEqual||function(e,t){return e===t};setTimeout(n,0);var a,s=t.oncePerStack(n),u=function(){return s(),r};return u.onChange=function(e){return a=e,u},u}};return t}.apply(t,r),!(void 0!==o&&(e.exports=o))},function(e,t,n){var r,o;r=[n(1),n(7),n(2),n(8),n(4),n(9)],o=function(e,t,n,r,o,i){"use strict";return function(){function a(t,n){function r(e){var n=f[t];f[t]=function(r){return p[t]?!0:(p[t]=n&&n(r)||e(r),p[t])}}r(o.isUndefined(n)?function(){return!1}:"string"==typeof n?function(){return c[n]}:e.isArray(n)?function(){return n.every(function(e){return c[e]})}:e.isFunction(n)?function(){return n(c)}:function(){return!!n})}function s(t,n){o.isUndefined(n)||(o.assert(e.isArray(n),"The 'requires' clause of a plugin should be an array of plugin names."),n.forEach(function(e){a(e,t)}))}var u=new t,c={},p={},f={};this.register=function(t){if(o.assert(e.isPlainObject(t),"An ApiNATOMY plugin should be a plain object."),o.assert("string"==typeof t.name,"An ApiNATOMY plugin should have a name."),e.isArray(t.after)||(t.after=[]),a(t.name,t.if),Object.defineProperty(c,t.name,{get:function(){return f[t.name](c)}}),s(t.name,t.require),u.addVertex(t.name,t),e.each(t.after,function(e,n){u.createEdge(n,t.name)}),u.hasCycle())throw new Error("The plugin application order has a cycle.");return t.delta=new i(t),t.delta},this.select=function l(t){e.isArray(t)&&t.forEach(l),a(t,!0)},this.apply=function(e){return n.all(r(u,function(t,r){return c[t]?(o.assert(r,"I don't know the '"+t+"' plugin."),n.resolve(r.delta.apply(e))):void 0}))}}}.apply(t,r),!(void 0!==o&&(e.exports=o))},function(e,t,n){var r,o;r=[n(2)],o=function(e){"use strict";return function(){var t,n,r=new e(function(){t=arguments[0],n=arguments[1]});return{resolve:t,reject:n,promise:r}}}.apply(t,r),!(void 0!==o&&(e.exports=o))},function(e){e.exports=n},function(e,t,n){var r,o;r=[n(2),n(6)],o=function(e,t){"use strict";return function(n,r){function o(e){return i[e]||(i[e]=t()),i[e]}var i={},a=[];return n.eachVertex(function(t,i){var s=n.predecessors(t),u=n.successors(t);0===u.length&&a.push(o(t).promise),e.all(s.map(function(e){return o(e).promise})).then(function(e){o(t).resolve(r(t,i,e))})}),a}}.apply(t,r),!(void 0!==o&&(e.exports=o))},function(e,t,n){var r,o;r=[n(1),n(7),n(2),n(8),n(4)],o=function(e,t,n,r,o){"use strict";function i(t){var n=t,r=n.name,i=n.constructor,a=n.apply,c=n.prototype,p=n.method,f={};o.isDefined(p)?Object.defineProperty(f,r,{value:p}):Object.defineProperty(f,r,{value:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this._addOperation(s[r],e,t),this}}),s[r]={name:r,Delta:i,method:f[r]},e.extend(s[r].Delta.prototype,c,{constructor:i,type:r,apply:a,compose:function(e,t){var n=this;if(o.isUndefined(t))return this;var r;if(u.some(function(e){var o=e,i=o.op1Type,a=o.op2Type,s=o.composeFn;return n.type===i&&t.type===a?(r=s,!0):void 0}),!r){var i=new Error("You cannot follow a '"+this.type+"' operation "+("with a '"+t.type+"' operation on the same property."));throw i.op1=this.type,i.op2=t.type,i}r(this,e,t)}}),s.modify.Delta.prototype[r]=s[r].method}function a(e,t,n){u.push({op1Type:e,op2Type:t,composeFn:n})}var s={},u=[],c=function(){},p=function(e,t,n){e[t]=n};return i({name:"modify",constructor:function(t,n){var r=this;t=t||{},this.operations=n||{},e.each(t,function(e,t){var n=e.match(/^(\w+)\s+([\w\.]+)$/);if(n){var i=n[1],a=n[2];o.assert(i in s,"I don't know the '"+i+"' operation."),r[i](a,t)}})},apply:function(e,t){var n=this;o.isDefined(t)?(o.assert(o.isDefined(e[t]),"The 'modify' operation expects the property to be already defined."),Object.keys(this.operations).forEach(function(r){n.operations[r].apply(e[t],r)})):(o.assert(o.isDefined(e),"The 'modify' operation expects the property to be already defined."),Object.keys(this.operations).forEach(function(t){n.operations[t].apply(e,t)}))},prototype:{_addOperation:function(e,t,n){var r=t.indexOf(".");if(-1!==r){var i=t.slice(0,r),a=t.slice(r+1),u=this._addOperation(s.modify,i);return u[e.name].apply(u,[a].concat(n))}var c=o.applyConstructor(e.Delta,n);return this.operations.hasOwnProperty(t)&&o.isDefined(this.operations[t])?this.compose(t,c):this.operations[t]=c,this.operations[t]}},method:function(e,t){return this._addOperation(s.modify,e,[t])}}),i({name:"add",constructor:function(e){this.value=e},apply:function(e,t){o.assert(o.isUndefined(e[t]),"The 'add' operation expects the property to first be undefined."),e[t]=this.value}}),i({name:"replace",constructor:function(e){this.value=e},apply:function(e,t){o.assert(o.isDefined(e[t]),"The 'replace' operation expects the property to be already defined."),e[t]=this.value}}),i({name:"remove",constructor:function(){},apply:function(e,t){o.assert(o.isDefined(e[t]),"The 'remove' operation expects the property to first be defined."),delete e[t]}}),i({name:"forbid",constructor:function(){},apply:function(e,t){o.assert(o.isUndefined(e[t]),"The 'forbid' operation requires the property to be undefined.")}}),a("add","replace",function(e,t,n){e[t]=new s.add.Delta(n.value)}),a("add","modify",function(e,t,n){n.apply(e[t],"value")}),a("add","remove",function(e,t){e[t]=new s.forbid.Delta}),a("replace","replace",p),a("replace","modify",function(e,t,n){n.apply(e[t],"value")}),a("replace","remove",p),a("modify","replace",p),a("modify","modify",function(e,t,n){Object.keys(n.operations).forEach(function(t){e.compose(t,n.operations[t])})}),a("modify","remove",p),a("remove","add",function(e,t,n){e[t]=new s.replace.Delta(n.value)}),a("remove","forbid",c),a("forbid","add",p),a("forbid","forbid",c),i({name:"insert",constructor:function(e){this.value=e},apply:function(t,n){o.assert(e.isFunction(t[n]),"The operation 'insert' expects the property to be a function.");var r=t[n],i=this.value;t[n]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.apply(this,e),i.apply(this,e)}}}),a("insert","replace",p),a("insert","remove",function(e,t){e[t]=new s.forbid.Delta}),a("add","insert",function(t,n,r){o.assert(e.isFunction(t[n].value),"The operation 'insert' expects the property it acts on to be a function."),r.apply(t[n],"value")}),a("replace","insert",function(t,n,r){o.assert(e.isFunction(t[n].value),"The operation 'insert' expects the property it acts on to be a function."),r.apply(t[n],"value")}),i({name:"after",constructor:function(e){this.value=e},apply:function(t,r){o.assert(e.isFunction(t[r]),"The operation 'after' expects the property to be a function.");var i=t[r],a=this.value;t[r]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.resolve(i.apply(this,e)).then(function(){return a.apply(this,e)}.bind(this))}}}),a("after","replace",p),a("after","remove",p),a("add","after",function(t,n,r){o.assert(e.isFunction(t[n].value),"The operation 'after' expects the property it acts on to be undefined or a function."),r.apply(t[n],"value")}),a("replace","after",function(t,n,r){o.assert(e.isFunction(t[n].value),"The operation 'after' expects the property it acts on to be undefined or a function."),r.apply(t[n],"value")}),a("insert","after",function(e,t,n){n.apply(e[t],"value")}),a("after","insert",function(e,t,n){n.apply(e[t],"value")}),s.modify.Delta}.apply(t,r),!(void 0!==o&&(e.exports=o))}])});
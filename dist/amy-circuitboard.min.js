!function(e,n){if("object"==typeof exports&&"object"==typeof module)module.exports=n(require("jquery"),require("bluebird"),require("js-graph"));else if("function"==typeof define&&define.amd)define(["jquery","bluebird","js-graph"],n);else{var t="object"==typeof exports?n(require("jquery"),require("bluebird"),require("js-graph")):n(e.jQuery,e.P,e.JsGraph);for(var r in t)("object"==typeof exports?exports:e)[r]=t[r]}}(this,function(e,n,t){return function(e){function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n,t){var r,i;r=[t(1),t(2),t(3),t(4)],i=function(e,n,t){"use strict";return t("circuitboard","circuitboard",{cssClass:"circuitboard",filter:function(){return n.resolve(!0)},model:null}),t("tilemap","tilemap",{cssClass:"tilemap",model:null,_circuitboard:null}),t("tile","tile",{cssClass:"tile",model:null,_circuitboard:null}),e.circuitboard}.apply(n,r),!(void 0!==i&&(e.exports=i))},function(n){n.exports=e},function(e){e.exports=n},function(e,n,t){var r,i;r=[t(1),t(2),t(5)],i=function(e,n,t){"use strict";function r(n){function t(n){return r[n]||(r[n]=e.Callbacks()),r[n]}var r={};e.extend(n,{on:function(e,n){t(e).add(n)},off:function(e,n){t(e).remove(n)},one:function(e,n){var t=arguments,r=this,i=function(){n.apply(null,t),r.off(e,i)};this.on(e,i)},once:function(e,n){this.one(e,n)},trigger:function(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];var i=r[e];i&&i.fireWith(this,n)}})}function i(n){Object.defineProperty(n,"type",{set:function(e){this._artefactType=e},get:function(){return this._artefactType}}),Object.defineProperty(n,"parent",{set:function(e){this._parent=e,t.array(e,"_children").push(this)},get:function(){return this._parent}}),Object.defineProperty(n,"children",{get:function(){return this._children}}),e.extend(n,{closestAncestorByType:function(e){var n=this;do n=n.parent;while(n&&n.type&&n.type!==e);return n},closestDescendantsByType:function(e){var n=[];return(this.children||[]).forEach(function(t){t.type===e?n.push(t):n=n.concat(t.closestDescendantsByType(e))}),n}})}function o(e){Object.defineProperty(e,"model",{get:function(){return this.options.model}})}return function(t,u,a){function c(){if(!s){var r={};s=n.all(e.circuitboard.plugin._apply(u,r)).return(r).tap(o).tap(i).tap(function(e){e.type=t})}return s}var s=null;e.fn[t]=function(n){var i=this;return"instance"===n?this.data("-amy-"+t):(this.data("-amy-"+t,c().then(function(t){var o=Object.create(t);return e.extend(o,{options:e.extend({},a,n),element:i,destroy:function(){o.trigger("destroy")}}),r(o),o.element.addClass(o.options.cssClass),o.element.one("remove",function(){o.destroy()}),o.options.parent&&(o.parent=o.options.parent),o.circuitboard=o.closestAncestorByType("circuitboard"),e.isFunction(o.constructor)&&o.constructor.call(o),o})),this)}}}.apply(n,r),!(void 0!==i&&(e.exports=i))},function(e,n,t){var r,i;r=[t(1),t(6)],i=function(e,n){"use strict";var t=new n;e.circuitboard||(e.circuitboard={}),e.circuitboard.plugin=t.register.bind(t),e.circuitboard.plugin._apply=t.apply.bind(t),(e.circuitboard.prematurePlugins||[]).forEach(e.circuitboard.plugin),delete e.circuitboard.prematurePlugins}.apply(n,r),!(void 0!==i&&(e.exports=i))},function(e,n,t){var r,i;r=[t(1)],i=function(e){"use strict";var n={approx:function(e,t,r){return n.isUndefined(r)&&(r=1e-5),Math.abs(e-t)<r},field:function(e){return function(n){return n[e]}},object:function(n,t){return e.isPlainObject(n[t])||(n[t]={}),n[t]},array:function(n,t){return e.isArray(n[t])||(n[t]=[]),n[t]},pull:function(e,n){var t=e.indexOf(n);-1!==t&&e.splice(t)},makeEmpty:function(e){for(;e.length>0;)e.pop()},bindA:function(e,n,t){return e.bind.apply(e,[n].concat(t))},bind:function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n.bindA(e[t],e,r)},applyConstructor:function(e,n){var t=e.bind.apply(e,[null].concat(n));return new t},assert:function(e,n){if(!e)throw new Error(n||"Assertion failed")},isUndefined:function(e){return"undefined"==typeof e},isDefined:function(e){return"undefined"!=typeof e},objValues:function(e){return Object.keys(e).map(function(n){return e[n]})},makePositioned:function(e){"static"===e.css("position")&&e.css("position","relative")},defOr:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0;r<e.length;r+=1)if(n.isDefined(e[r]))return e[r]},debounce:function(e,n,t){var r;return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var u=function(){r=null,e.apply(t,i)};clearTimeout(r),r=setTimeout(u,n)}},oncePerStack:function(e,n){var t=!0;return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];t&&(t=!1,setTimeout(function(){t=!0},0),e.apply(n,r))}},cached:function(e){function t(){var e=r;r=i(),u&&!o(r,e)&&u(r,e)}var r,i=e.retrieve,o=e.isEqual||function(e,n){return e===n};setTimeout(t,0);var u,a=n.oncePerStack(t),c=function(){return a(),r};return c.onChange=function(e){return u=e,c},c}};return n}.apply(n,r),!(void 0!==i&&(e.exports=i))},function(e,n,t){var r,i;r=[t(1),t(7),t(2),t(8),t(5)],i=function(e,n,t,r,i){"use strict";function o(n){var t={};return e.each(n,function(e,n){var r=e.match(/^(\w+)\s+(\w+)$/);r&&(t[r[2]]={operation:r[1],value:n})}),t}return function(){function u(n,t){function r(e){var t=p[n];p[n]=function(r){return f[n]?!0:(f[n]=t&&t(r)||e(r),f[n])}}r(i.isUndefined(t)?function(){return!1}:"string"==typeof t?function(){return s[t]}:e.isArray(t)?function(){return t.every(function(e){return s[e]})}:e.isFunction(t)?function(){return t(s)}:function(){return!!t})}function a(n){i.assert("string"==typeof n.name,"An ApiNATOMY plugin should have a name."),e.isArray(n.after)||(n.after=[]),u(n.name,n.if),Object.defineProperty(s,n.name,{get:function(){return p[n.name](s)}}),c.addVertex(n.name,n),e.each(n.after,function(e,t){c.createEdge(t,n.name)});try{c.topologically(function(){})}catch(t){throw new Error("The plugin application order has a cycle: "+t.cycle)}n._operations=o(n)}var c=new n,s={},f={},p={};this.register=function(n){var t=this;e.isArray(n)?e.each(n,function(e,n){t.register(n)}):e.isPlainObject(n)?a(n):"string"==typeof n&&u(n,!0)},this.apply=function(n,u){return r(c,function(r,a){if(!a)throw new Error("I don't know the '"+r+"' plugin.");if(s[r]){var c=a._operations[n];if(c){i.assert("modify"===c.operation,"Any top-level operation on '"+n+"' must be 'modify'.");var f=o(c.value);e.each(f,function(r,o){switch(o.operation){case"add":i.assert(i.isUndefined(u[r]),"The operation 'add "+r+"' expects "+n+"."+r+" to first be undefined."),u[r]=o.value;break;case"remove":i.assert(i.isDefined(u[r]),"The operation 'remove "+r+"' expects "+n+"."+r+" to first be defined."),delete u[r];break;case"replace":i.assert(i.isDefined(u[r]),"The operation 'replace "+r+"' expects "+n+"."+r+" to first be defined."),u[r]=o.value;break;case"insert":i.assert(i.isUndefined(u[r])||e.isFunction(u[r]),"The operation 'insert "+r+"' expects "+n+"."+r+" to be undefined or a function.");var a=u[r];u[r]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return a.apply(this,e),o.value.apply(this,e)};break;case"after":i.assert(i.isUndefined(u[r])||e.isFunction(u[r]),"The operation 'after "+r+"' expects "+n+"."+r+" to be undefined or a function.");var c=u[r];u[r]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.resolve(c.apply(this,e)).then(function(n){return o.value.apply(this,[n].concat(e))}.bind(this))}}})}}})}}}.apply(n,r),!(void 0!==i&&(e.exports=i))},function(e){e.exports=t},function(e,n,t){var r,i;r=[t(2),t(9)],i=function(e,n){"use strict";return function(t,r){function i(e){return o[e]||(o[e]=n()),o[e]}var o={},u=[];return t.eachVertex(function(n,o){var a=t.predecessors(n),c=t.successors(n);0===c.length&&u.push(i(n).promise),e.all(a.map(function(e){return i(e).promise})).then(function(e){i(n).resolve(r(n,o,e))})}),u}}.apply(n,r),!(void 0!==i&&(e.exports=i))},function(e,n,t){var r,i;r=[t(2)],i=function(e){"use strict";return function(){var n,t,r=new e(function(){n=arguments[0],t=arguments[1]});return{resolve:n,reject:t,promise:r}}}.apply(n,r),!(void 0!==i&&(e.exports=i))}])});